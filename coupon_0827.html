<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JAPANKURU Wallet (Demo)</title>

  <style>
    :root{
      --primary:#007AFF; --secondary:#5856D6; --success:#34C759; --warning:#FF9500; --danger:#FF3B30;
      --gray-50:#F2F2F7; --gray-100:#E5E5EA; --gray-200:#D1D1D6; --gray-300:#C7C7CC; --gray-400:#AEAEB2;
      --gray-500:#8E8E93; --gray-600:#636366; --gray-700:#48484A; --gray-800:#2C2C2E; --gray-900:#1C1C1E;
      --bg:#FFFFFF; --surface:#F2F2F7; --text:#000000; --text-secondary:#8E8E93;
      --radius:20px; --radius-sm:12px; --radius-xs:8px;
      --shadow-sm:0 1px 3px rgba(0,0,0,.12); --shadow:0 4px 12px rgba(0,0,0,.08); --shadow-lg:0 10px 40px rgba(0,0,0,.12);
      --font:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text","Helvetica Neue",sans-serif;
    }
    @media (prefers-color-scheme:dark){
      :root{ --bg:#000; --surface:#1C1C1E; --text:#fff; --text-secondary:#8E8E93; --gray-50:#1C1C1E; --gray-100:#2C2C2E;}
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:var(--font);background:var(--surface);color:var(--text);line-height:1.5;font-size:17px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}
    header{background:rgba(255,255,255,.8);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:.5px solid var(--gray-200);position:sticky;top:0;z-index:100}
    @media (prefers-color-scheme:dark){header{background:rgba(28,28,30,.8)}}
    .header-inner{display:flex;justify-content:space-between;align-items:center;height:52px}
    .logo{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--text);font-weight:600;font-size:19px}
    .logo img{height:28px;width:auto}
    .lang-select{padding:6px 12px;border:none;border-radius:var(--radius-xs);background:var(--gray-100);color:var(--text);font-size:15px;cursor:pointer;font-family:inherit;min-width:120px;transition:.2s}
    .lang-select:hover{background:var(--gray-200)}
    .lang-select:focus{outline:none;box-shadow:0 0 0 4px rgba(0,122,255,.3)}
    .hero{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;padding:60px 40px;border-radius:var(--radius);margin:30px 0;text-align:center}
    .hero h1{font-size:48px;font-weight:700;margin-bottom:12px;letter-spacing:-.02em}
    .hero p{font-size:21px;opacity:.95}
    @media (max-width:768px){.hero{padding:40px 20px}.hero h1{font-size:32px}.hero p{font-size:17px}}
    .search-bar{margin-bottom:30px}
    .search-wrapper{position:relative}
    .search-input{width:100%;padding:16px 20px 16px 48px;border:none;border-radius:var(--radius-sm);background:var(--bg);font-size:17px;transition:.2s;box-shadow:var(--shadow)}
    .search-icon{position:absolute;left:20px;top:50%;transform:translateY(-50%);color:var(--gray-400);pointer-events:none}
    .search-input:focus{outline:none;box-shadow:0 0 0 4px rgba(0,122,255,.3)}
    .tabs{display:flex;gap:10px;margin-bottom:30px;overflow-x:auto;padding-bottom:10px;-webkit-overflow-scrolling:touch;scrollbar-width:none}
    .tabs::-webkit-scrollbar{display:none}
    .tab{padding:10px 20px;border:none;background:var(--bg);border-radius:100px;cursor:pointer;font-size:15px;font-weight:500;white-space:nowrap;transition:.2s;box-shadow:var(--shadow-sm);color:var(--text);font-family:inherit}
    .tab:hover{transform:scale(1.05);box-shadow:var(--shadow)}
    .tab.active{background:var(--primary);color:#fff;box-shadow:0 4px 12px rgba(0,122,255,.3)}
    .badge{display:inline-block;background:rgba(0,0,0,.1);padding:2px 8px;border-radius:100px;font-size:12px;margin-left:6px;font-weight:600}
    .tab.active .badge{background:rgba(255,255,255,.3)}
    .coupon-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:24px;margin-bottom:60px}
    @media (max-width:768px){.coupon-grid{grid-template-columns:1fr;gap:16px}}
    .coupon-card{background:var(--bg);border-radius:var(--radius-sm);overflow:hidden;box-shadow:var(--shadow);transition:all .3s cubic-bezier(.25,.46,.45,.94);cursor:pointer;position:relative}
    .coupon-card:hover{transform:translateY(-8px);box-shadow:var(--shadow-lg)}
    .coupon-card:focus{outline:2px solid var(--primary);outline-offset:2px}
    .coupon-card img{width:100%;height:200px;object-fit:cover}
    .expiry-badge{position:absolute;top:12px;right:12px;background:var(--danger);color:#fff;padding:6px 12px;border-radius:100px;font-size:13px;font-weight:600;box-shadow:var(--shadow)}
    .coupon-body{padding:20px}
    .coupon-title{font-size:22px;font-weight:600;margin-bottom:8px;letter-spacing:-.01em}
    .coupon-offer{font-size:28px;color:var(--danger);font-weight:700;margin-bottom:12px}
    .coupon-desc{font-size:15px;color:var(--text-secondary);margin-bottom:16px;line-height:1.4;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}
    .coupon-footer{display:flex;justify-content:space-between;align-items:center;padding-top:16px;border-top:1px solid var(--gray-100)}
    .coupon-area{font-size:14px;color:var(--text-secondary);display:flex;align-items:center;gap:6px}
    .save-btn{padding:8px 16px;border:none;background:var(--gray-100);border-radius:100px;cursor:pointer;font-size:14px;font-weight:500;transition:.2s;display:flex;align-items:center;gap:4px;font-family:inherit}
    .save-btn:hover{background:var(--gray-200);transform:scale(1.05)}
    .save-btn.saved{background:var(--warning);color:#fff}
    .save-btn.saved:hover{background:#FF8800}
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);z-index:1000;padding:20px;overflow-y:auto}
    .modal.show{display:flex;align-items:center;justify-content:center;animation:fadeIn .3s}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .modal-content{background:var(--bg);border-radius:var(--radius);width:100%;max-width:560px;max-height:90vh;overflow-y:auto;position:relative;animation:slideUp .3s;box-shadow:var(--shadow-lg)}
    @keyframes slideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
    .modal-body{padding:30px}
    .modal-close{position:absolute;top:20px;right:20px;width:36px;height:36px;border:none;background:var(--gray-100);border-radius:50%;cursor:pointer;font-size:20px;display:flex;align-items:center;justify-content:center;transition:.2s;color:var(--text)}
    .modal-close:hover{background:var(--gray-200);transform:scale(1.1)}
    .modal-title{font-size:28px;font-weight:600;margin-bottom:8px;padding-right:40px;letter-spacing:-.02em}
    .modal-offer{font-size:30px;color:var(--danger);font-weight:700;margin-bottom:18px}
    .coupon-image-box{background:var(--surface);padding:16px;border-radius:var(--radius-sm);text-align:center;margin-bottom:18px}
    .coupon-image{width:100%;height:auto;border-radius:12px;box-shadow:var(--shadow)}
    .btn{padding:12px 20px;border:none;border-radius:100px;font-size:16px;font-weight:500;cursor:pointer;transition:.2s;font-family:inherit;display:inline-flex;align-items:center;justify-content:center;gap:8px;min-width:120px}
    .btn-primary{background:var(--primary);color:#fff}
    .btn-primary:hover{transform:scale(1.05)}
    .btn-secondary{background:var(--gray-100);color:var(--text)}
    .btn-secondary:hover{background:var(--gray-200);transform:scale(1.05)}
    .links-section{display:flex;flex-direction:column;gap:12px;margin:18px 0;padding:16px;background:var(--surface);border-radius:var(--radius-sm)}
    .link-item{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--bg);border-radius:var(--radius-xs);text-decoration:none;color:var(--text);transition:.2s;border:1px solid var(--gray-100)}
    .link-item:hover{background:var(--gray-50);transform:translateX(4px);box-shadow:var(--shadow-sm)}
    .modal-section{margin:18px 0}
    .modal-section h3{font-size:17px;font-weight:600;margin-bottom:10px;color:var(--text-secondary)}
    .modal-section ul{list-style:none}
    .modal-section li{font-size:15px;color:var(--text);margin-bottom:8px;padding-left:20px;position:relative;line-height:1.5}
    .modal-section li:before{content:"‚Ä¢";position:absolute;left:8px;color:var(--gray-400)}
    .modal-info{display:flex;align-items:center;gap:8px;font-size:15px;color:var(--text-secondary);margin-bottom:6px}
    .close-modal-btn{width:100%;margin-top:16px}
    .saved-info{background:linear-gradient(135deg,var(--warning),#FF8800);color:#fff;padding:12px 16px;border-radius:var(--radius-sm);margin-bottom:18px;display:none;font-weight:500;box-shadow:var(--shadow)}
    .saved-info.show{display:block}
    .no-results{text-align:center;padding:80px 20px;display:none}
    .no-results.show{display:block}
    .no-results-icon{font-size:72px;margin-bottom:20px;opacity:.5}
    @media (max-width:640px){.modal-content{margin:20px;max-height:calc(100vh - 40px)}.tabs{padding:0 20px 10px;margin:0 -20px 30px}}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="header-inner">
        <a href="#" class="logo" aria-label="JAPANKURU Wallet">
          <img src="https://japankuru.com/gld-kanri/data/themes/japankuru/assets/images/logo.svg" alt="Japankuru"/>
          <span>Wallet</span>
        </a>
        <select id="langSelect" class="lang-select" aria-label="Language">
          <option value="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
          <option value="en">üá∫üá∏ English</option>
          <option value="zh">üá®üá≥ ÁÆÄ‰Ωì‰∏≠Êñá</option>
          <option value="zh-tw">üáπüáº ÁπÅÈ´î‰∏≠Êñá</option>
          <option value="th">üáπüá≠ ‡πÑ‡∏ó‡∏¢</option>
          <option value="id">üáÆüá© Indonesia</option>
        </select>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="hero">
      <h1 data-i18n="hero_title">ÏùºÎ≥∏ Ïó¨Ìñâ Ìï†Ïù∏ Ïø†Ìè∞</h1>
      <p data-i18n="hero_desc">Ïù∏Í∏∞ Îß§Ïû•ÏóêÏÑú Î∞îÎ°ú ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Ìï†Ïù∏ Ïø†Ìè∞</p>
    </div>

    <div class="search-bar">
      <div class="search-wrapper">
        <span class="search-icon">üîç</span>
        <input id="searchInput" class="search-input" type="search"
               placeholder="Îß§Ïû•Î™Ö, ÏßÄÏó≠ÏúºÎ°ú Í≤ÄÏÉâ..." data-i18n-placeholder="search_placeholder" />
      </div>
    </div>

    <div class="tabs" id="categoryTabs">
      <button type="button" class="tab active" data-category="all"><span data-i18n="cat_all">Ï†ÑÏ≤¥</span> <span class="badge">0</span></button>
      <button type="button" class="tab" data-category="electronics"><span>üîå</span> <span data-i18n="cat_electronics">Ï†ÑÏûêÏ†úÌíà</span> <span class="badge">0</span></button>
      <button type="button" class="tab" data-category="fashion"><span>üëï</span> <span data-i18n="cat_fashion">Ìå®ÏÖò</span> <span class="badge">0</span></button>
      <button type="button" class="tab" data-category="dining"><span>üçΩÔ∏è</span> <span data-i18n="cat_dining">ÎßõÏßë</span> <span class="badge">0</span></button>
      <button type="button" class="tab" data-category="transport"><span>üöá</span> <span data-i18n="cat_transport">ÍµêÌÜµ</span> <span class="badge">0</span></button>
      <button type="button" class="tab" data-category="saved"><span>‚≠ê</span> <span data-i18n="cat_saved">Ï†ÄÏû•Îê®</span> <span class="badge" id="savedBadge">0</span></button>
    </div>

    <div class="saved-info" id="savedInfo">
      <span data-i18n="saved_info">Ï†ÄÏû•Îêú Ïø†Ìè∞</span> <strong id="savedCount">0</strong><span data-i18n="saved_unit">Í∞ú</span>
    </div>

    <div id="couponGrid" class="coupon-grid"></div>

    <div id="noResults" class="no-results">
      <div class="no-results-icon">üîç</div>
      <h3 data-i18n="no_results">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§</h3>
      <p data-i18n="no_results_desc">Îã§Î•∏ Í≤ÄÏÉâÏñ¥Î•º ÏãúÎèÑÌï¥Î≥¥ÏÑ∏Ïöî</p>
    </div>
  </div>

  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <button type="button" class="modal-close" aria-label="Close" onclick="closeModal()">√ó</button>
      <div id="modalBody" class="modal-body"></div>
    </div>
  </div>

  <script>
    // ========= DEMOÁî®: ÏÉòÌîå Îç∞Ïù¥ÌÑ∞ =========
    // ‚Äª Î≥∏Áï™ WordPressÏóêÏÑúÎäî PHPÍ∞Ä ÏïÑÎûò ÌòïÌÉúÏùò JSONÏùÑ 1Ìöå Ï£ºÏûÖÌï©ÎãàÎã§.
    //   <script>const couponsData=[{...}, ...];</script>
    const couponsData = [
      {
        id: 1,
        store_ko:'ÏΩîÏßÄÎßà x ÎπÖÏπ¥Î©îÎùº', store_en:'Kojima x BicCamera', store_zh:'Â∞èÂ≤õ x Bic Camera', 'store_zh-tw':'Â∞èÂ≥∂ x Bic Camera', store_th:'‡πÇ‡∏Ñ‡∏à‡∏¥‡∏°‡∏∞ x ‡∏ö‡∏¥‡∏Å‡∏Ñ‡∏≤‡πÄ‡∏°‡∏£‡πà‡∏≤', store_id:'Kojima x BicCamera',
        offer:'ÏµúÎåÄ 17% OFF', offer_en:'Up to 17% OFF',
        description_ko:'Î©¥ÏÑ∏ 10% + Ï∂îÍ∞Ä 7% Ìï†Ïù∏! ÏµúÏã† Ï†ÑÏûêÏ†úÌíàÏùÑ Ï†ÄÎ†¥ÌïòÍ≤å.', description_en:'Tax-free 10% + Additional 7% discount!',
        category:'electronics', expiry:'2025-12-31',
        image:'https://japankuru.com/gld-kanri/data/uploads/2023/11/kojima%E8%8B%B1%E8%AA%9E%E7%89%88%E4%BC%81%E6%A5%AD%E6%9C%89_kojima_EN_B-2.jpg',
        coupon_image:'https://img.japankuru.com/prg_img/thumbnail1/img2023112417190332724100.png',
        area_ko:'ÏïÑÌÇ§ÌïòÎ∞îÎùº', area_en:'Akihabara',
        terms_ko:'ÌÉÄ Ìï†Ïù∏Í≥º Ï§ëÎ≥µ Î∂àÍ∞Ä|ÏùºÎ∂Ä ÌíàÎ™© Ï†úÏô∏|Í≥ÑÏÇ∞ Ï†Ñ Ï†úÏãú|1Ïù∏ 1Ìöå', terms_en:'Cannot combine|Some items excluded|Show before payment|Once per person',
        article_url:'https://www.japankuru.com/en/e2290.html', official_url:'https://www.biccamera.com', maps_url:'https://maps.google.com/?q=35.6909,139.7003'
      },
      {
        id: 2,
        store_ko:'ÏßÑÏä§ (JINS)', store_en:'JINS', store_zh:'JINS', 'store_zh-tw':'JINS', store_th:'‡∏à‡∏¥‡∏ô‡∏™‡πå', store_id:'JINS',
        offer:'10% OFF', offer_en:'10% OFF',
        description_ko:'Î©¥ÏÑ∏+Ìï†Ïù∏ ÏïàÍ≤Ω.', description_en:'Tax-free + discount glasses.',
        category:'fashion', expiry:'2025-02-05',
        image:'https://japankuru.com/gld-kanri/data/uploads/2024/06/japankuru_1800-1200-1536x1024.jpg',
        coupon_image:'https://japankuru.com/gld-kanri/data/uploads/2024/06/japankuru_1800-1200-1536x1024.jpg',
        area_ko:'ÏãúÎ∂ÄÏïº', area_en:'Shibuya',
        terms_ko:'ÌÉÄ Ìï†Ïù∏Í≥º Ï§ëÎ≥µ Î∂àÍ∞Ä|ÏùºÎ∂Ä ÌíàÎ™© Ï†úÏô∏', terms_en:'Cannot combine|Some items excluded',
        article_url:'https://www.japankuru.com/en/e2291.html', official_url:'https://www.jins.com', maps_url:'https://maps.google.com/?q=35.6581,139.6986'
      },
      {
        id: 3,
        store_ko:'BEAMS JAPAN', store_en:'BEAMS JAPAN',
        offer:'5% Ï∂îÍ∞Ä Ìï†Ïù∏', offer_en:'5% Extra OFF',
        description_ko:'ÏùºÎ∂Ä ÌíàÎ™© Ï†úÏô∏', description_en:'Some exclusions apply',
        category:'fashion', expiry:'2025-09-30',
        image:'https://img.japankuru.com/prg_img/img/img2024011517461371466800.jpg',
        coupon_image:'https://img.japankuru.com/prg_img/img/img2024011517461371466800.jpg',
        area_ko:'Ïã†Ï£ºÏø†', area_en:'Shinjuku',
        terms_ko:'ÌÉÄ Ìï†Ïù∏Í≥º Ï§ëÎ≥µ Î∂àÍ∞Ä', terms_en:'Cannot combine',
        official_url:'https://www.beams.co.jp', maps_url:'https://maps.google.com/?q=35.6702,139.7073'
      },
      {
        id: 4,
        store_ko:'ÏÇ¨Î¨¥ÎùºÏù¥ Î†àÏä§ÌÜ†Îûë', store_en:'Samurai Restaurant',
        offer:'ÏùåÎ£å 1Ïûî Î¨¥Î£å', offer_en:'1 Free Drink',
        description_ko:'ÏÜåÌîÑÌä∏ÎìúÎßÅÌÅ¨ ÌïúÏ†ï', description_en:'Soft drinks only',
        category:'dining', expiry:'2026-03-31',
        image:'https://japankuru.com/gld-kanri/data/uploads/2024/06/%E4%BE%8D%E3%82%AF%E3%83%BC%E3%83%9D%E3%83%B3c-2_0_0-1536x864.jpeg',
        coupon_image:'https://japankuru.com/gld-kanri/data/uploads/2024/06/%E4%BE%8D%E3%82%AF%E3%83%BC%E3%83%9D%E3%83%B3c-2_0_0-1536x864.jpeg',
        area_ko:'Ïã†Ï£ºÏø†', area_en:'Shinjuku',
        terms_ko:'ÏùåÎ£åÎäî ÏÜåÌîÑÌä∏ÎìúÎßÅÌÅ¨ ÌïúÏ†ï', terms_en:'Soft drinks only',
        official_url:'https://www.samurai-restaurant.com', maps_url:'https://maps.google.com/?q=35.6947,139.7006'
      },
      {
        id: 5,
        store_ko:'ÎèÑÌÅêÏÑ†', store_en:'Tokyu Line',
        offer:'1Ïùº ÏäπÏ∞®Í∂å', offer_en:'1-Day Pass',
        description_ko:'ÎãπÏùº ÌïúÏ†ï ÏÇ¨Ïö©', description_en:'Valid on day of use only',
        category:'transport', expiry:'9999-12-31',
        image:'https://japankuru.com/gld-kanri/data/uploads/2025/03/tokyu-cover-16-9-1-1536x864.png',
        coupon_image:'https://japankuru.com/gld-kanri/data/uploads/2025/03/tokyu-cover-16-9-1-1536x864.png',
        area_ko:'ÏãúÎ∂ÄÏïº', area_en:'Shibuya',
        official_url:'https://www.tokyu.co.jp'
      },
      {
        id: 6,
        store_ko:'ÏöîÎèÑÎ∞îÏãúÏπ¥Î©îÎùº', store_en:'Yodobashi Camera',
        offer:'ÏµúÎåÄ 15% OFF', offer_en:'Up to 15% OFF',
        description_ko:'VISA Ïπ¥Îìú Í≤∞Ï†úÏãúÎßå', description_en:'VISA card payment only',
        category:'electronics', expiry:'2025-11-30',
        image:'https://img.japankuru.com/prg_img/thumbnail1/img2023112417190332724100.png',
        coupon_image:'https://img.japankuru.com/prg_img/thumbnail1/img2023112417190332724100.png',
        area_ko:'ÏïÑÌÇ§ÌïòÎ∞îÎùº', area_en:'Akihabara',
        official_url:'https://www.yodobashi.com', maps_url:'https://maps.google.com/?q=35.6938,139.7706'
      }
    ];

    // ========= Ïú†Ìã∏/XSS =========
    const esc=(s)=>String(s??'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));

    // ========= Îã§Íµ≠Ïñ¥ Î¨∏Íµ¨ =========
    const translations={
      ko:{hero_title:'ÏùºÎ≥∏ Ïó¨Ìñâ Ìï†Ïù∏ Ïø†Ìè∞',hero_desc:'Ïù∏Í∏∞ Îß§Ïû•ÏóêÏÑú Î∞îÎ°ú ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Ìï†Ïù∏ Ïø†Ìè∞',
          search_placeholder:'Îß§Ïû•Î™Ö, ÏßÄÏó≠ÏúºÎ°ú Í≤ÄÏÉâ...',cat_all:'Ï†ÑÏ≤¥',cat_electronics:'Ï†ÑÏûêÏ†úÌíà',cat_fashion:'Ìå®ÏÖò',cat_dining:'ÎßõÏßë',cat_transport:'ÍµêÌÜµ',cat_saved:'Ï†ÄÏû•Îê®',
          saved_info:'Ï†ÄÏû•Îêú Ïø†Ìè∞',saved_unit:'Í∞ú',no_results:'Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§',no_results_desc:'Îã§Î•∏ Í≤ÄÏÉâÏñ¥Î•º ÏãúÎèÑÌï¥Î≥¥ÏÑ∏Ïöî',
          save:'Ï†ÄÏû•',unsave:'Ï†ÄÏû• Ìï¥Ï†ú',close:'Îã´Í∏∞',terms:'Ïù¥Ïö©Ï°∞Í±¥',expiry:'Ïú†Ìö®Í∏∞Ìïú',no_expiry:'Î¨¥Ï†úÌïú',
          share:'Í≥µÏú†',view_article:'Í¥ÄÎ†® Í∏∞ÏÇ¨',visit_website:'Í≥µÏãù ÌôàÌéòÏù¥ÏßÄ',view_map:'ÏßÄÎèÑ Î≥¥Í∏∞',
          days_left:'Ïùº ÎÇ®Ïùå',expires_today:'Ïò§Îäò ÎßàÍ∞ê',view_image:'Ïù¥ÎØ∏ÏßÄ Î≥¥Í∏∞',download_image:'Ïù¥ÎØ∏ÏßÄ Îã§Ïö¥Î°úÎìú',copied:'Î≥µÏÇ¨ÏôÑÎ£å!'},
      en:{hero_title:'Japan Travel Discount Coupons',hero_desc:'Instant discounts at popular stores',
          search_placeholder:'Search by store or area...',cat_all:'All',cat_electronics:'Electronics',cat_fashion:'Fashion',cat_dining:'Dining',cat_transport:'Transport',cat_saved:'Saved',
          saved_info:'Saved coupons',saved_unit:'',no_results:'No results found',no_results_desc:'Try different search terms',
          save:'Save',unsave:'Unsave',close:'Close',terms:'Terms',expiry:'Expiry',no_expiry:'No expiry',
          share:'Share',view_article:'Related Article',visit_website:'Official Website',view_map:'View Map',
          days_left:'days left',expires_today:'Ends today',view_image:'View Image',download_image:'Download Image',copied:'Copied!'},
      zh:{hero_title:'Êó•Êú¨ÊóÖË°å‰ºòÊÉ†Âà∏',hero_desc:'ÁÉ≠Èó®ÂïÜÂ∫óÂç≥Êó∂ÊäòÊâ£',
          search_placeholder:'ÊåâÂ∫óÂêçÊàñÂú∞Âå∫ÊêúÁ¥¢...',cat_all:'ÂÖ®ÈÉ®',cat_electronics:'ÁîµÂ≠ê‰∫ßÂìÅ',cat_fashion:'Êó∂Â∞ö',cat_dining:'ÁæéÈ£ü',cat_transport:'‰∫§ÈÄö',cat_saved:'Â∑≤‰øùÂ≠ò',
          saved_info:'Â∑≤‰øùÂ≠òÁöÑ‰ºòÊÉ†Âà∏',saved_unit:'Âº†',no_results:'Ê≤°ÊúâÊâæÂà∞ÁªìÊûú',no_results_desc:'Â∞ùËØïÂÖ∂‰ªñÊêúÁ¥¢ËØç',
          save:'‰øùÂ≠ò',unsave:'ÂèñÊ∂à‰øùÂ≠ò',close:'ÂÖ≥Èó≠',terms:'‰ΩøÁî®Êù°Ê¨æ',expiry:'ÊúâÊïàÊúü',no_expiry:'Êó†ÊúüÈôê',
          share:'ÂàÜ‰∫´',view_article:'Áõ∏ÂÖ≥ÊñáÁ´†',visit_website:'ÂÆòÊñπÁΩëÁ´ô',view_map:'Êü•ÁúãÂú∞Âõæ',
          days_left:'Â§©Ââ©‰Ωô',expires_today:'‰ªäÂ§©Âà∞Êúü',view_image:'Êü•ÁúãÂõæÁâá',download_image:'‰∏ãËΩΩÂõæÁâá',copied:'Â∑≤Â§çÂà∂ÔºÅ'},
      'zh-tw':{hero_title:'Êó•Êú¨ÊóÖË°åÂÑ™ÊÉ†Âà∏',hero_desc:'ÁÜ±ÈñÄÂïÜÂ∫óÂç≥ÊôÇÊäòÊâ£',
          search_placeholder:'ÊåâÂ∫óÂêçÊàñÂú∞ÂçÄÊêúÁ¥¢...',cat_all:'ÂÖ®ÈÉ®',cat_electronics:'ÈõªÂ≠êÁî¢ÂìÅ',cat_fashion:'ÊôÇÂ∞ö',cat_dining:'ÁæéÈ£ü',cat_transport:'‰∫§ÈÄö',cat_saved:'Â∑≤‰øùÂ≠ò',
          saved_info:'Â∑≤‰øùÂ≠òÁöÑÂÑ™ÊÉ†Âà∏',saved_unit:'Âºµ',no_results:'Ê≤íÊúâÊâæÂà∞ÁµêÊûú',no_results_desc:'ÂòóË©¶ÂÖ∂‰ªñÊêúÁ¥¢Ë©û',
          save:'‰øùÂ≠ò',unsave:'ÂèñÊ∂à‰øùÂ≠ò',close:'ÈóúÈñâ',terms:'‰ΩøÁî®Ê¢ùÊ¨æ',expiry:'ÊúâÊïàÊúü',no_expiry:'ÁÑ°ÊúüÈôê',
          share:'ÂàÜ‰∫´',view_article:'Áõ∏ÈóúÊñáÁ´†',visit_website:'ÂÆòÊñπÁ∂≤Á´ô',view_map:'Êü•ÁúãÂú∞Âúñ',
          days_left:'Â§©Ââ©È§ò',expires_today:'‰ªäÂ§©Âà∞Êúü',view_image:'Êü•ÁúãÂúñÁâá',download_image:'‰∏ãËºâÂúñÁâá',copied:'Â∑≤Ë§áË£ΩÔºÅ'},
      th:{hero_title:'‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô',hero_desc:'‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°',
          search_placeholder:'‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà...',cat_all:'‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',cat_electronics:'‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå',cat_fashion:'‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô',cat_dining:'‡∏≠‡∏≤‡∏´‡∏≤‡∏£',cat_transport:'‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á',cat_saved:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß',
          saved_info:'‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',saved_unit:'‡πÉ‡∏ö',no_results:'‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå',no_results_desc:'‡∏•‡∏≠‡∏á‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏∑‡πà‡∏ô',
          save:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',unsave:'‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',close:'‡∏õ‡∏¥‡∏î',terms:'‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç',expiry:'‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏',no_expiry:'‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≥‡∏´‡∏ô‡∏î',
          share:'‡πÅ‡∏ä‡∏£‡πå',view_article:'‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á',visit_website:'‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£',view_map:'‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà',
          days_left:'‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠',expires_today:'‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ',view_image:'‡∏î‡∏π‡∏†‡∏≤‡∏û',download_image:'‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û',copied:'‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!'},
      id:{hero_title:'Kupon Diskon Perjalanan Jepang',hero_desc:'Diskon instan di toko-toko populer',
          search_placeholder:'Cari berdasarkan nama toko atau area...',cat_all:'Semua',cat_electronics:'Elektronik',cat_fashion:'Fashion',cat_dining:'Kuliner',cat_transport:'Transportasi',cat_saved:'Tersimpan',
          saved_info:'Kupon tersimpan',saved_unit:'',no_results:'Tidak ada hasil',no_results_desc:'Coba kata kunci lain',
          save:'Simpan',unsave:'Batal simpan',close:'Tutup',terms:'Syarat',expiry:'Berlaku hingga',no_expiry:'Tidak terbatas',
          share:'Bagikan',view_article:'Artikel Terkait',visit_website:'Situs Resmi',view_map:'Lihat Peta',
          days_left:'hari tersisa',expires_today:'Berakhir hari ini',view_image:'Lihat Gambar',download_image:'Unduh Gambar',copied:'Tersalin!'}
    };

    // ========= ÏÉÅÌÉú Î≥ÄÏàò =========
    let currentLang = (localStorage.getItem('selectedLang') || navigator.language || 'ko').toLowerCase();
    if(currentLang.startsWith('zh') && (currentLang.includes('tw')||currentLang.includes('hk'))) currentLang='zh-tw';
    if(!['ko','en','zh','zh-tw','th','id'].includes(currentLang)) currentLang='ko';
    let savedCoupons = JSON.parse(localStorage.getItem('savedCoupons')||'[]');
    let filteredCoupons = [...couponsData];
    let currentCategory = 'all';
    let _lastFocused=null,_trapHandler=null,_searchTimer=null;

    // ========= Ïñ∏Ïñ¥ Î∞òÏòÅ =========
    function updateLanguage(){
      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const key=el.getAttribute('data-i18n');
        if(translations[currentLang] && translations[currentLang][key]) el.textContent=translations[currentLang][key];
      });
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el=>{
        const key=el.getAttribute('data-i18n-placeholder');
        if(translations[currentLang] && translations[currentLang][key]) el.setAttribute('placeholder',translations[currentLang][key]);
      });
    }
    function detectLanguage(){
      const sel=document.getElementById('langSelect');
      if(sel) sel.value=currentLang;
      document.documentElement.lang=currentLang;
    }

    // ========= ÎÇ†Ïßú(JST) =========
    function getDaysLeft(expiry){
      if(!expiry || expiry==='9999-12-31') return 999;
      const end=new Date(`${expiry}T23:59:59+09:00`);
      const now=new Date();
      const jst= new Date(now.getTime() + ((9*60)+now.getTimezoneOffset())*60000);
      const diff=Math.ceil((end-jst)/(1000*60*60*24));
      return diff>0?diff:0;
    }

    // ========= Î∞∞ÏßÄ =========
    function updateCategoryBadges(){
      const counts={
        all:couponsData.length,
        electronics:couponsData.filter(c=>c.category==='electronics').length,
        fashion:couponsData.filter(c=>c.category==='fashion').length,
        dining:couponsData.filter(c=>c.category==='dining').length,
        transport:couponsData.filter(c=>c.category==='transport').length,
        saved:savedCoupons.length
      };
      Object.keys(counts).forEach(cat=>{
        const el=document.querySelector(`.tab[data-category="${cat}"] .badge`);
        if(el) el.textContent=counts[cat];
      });
    }

    // ========= Î†åÎçî =========
    function renderCoupons(){
      const grid=document.getElementById('couponGrid');
      const empty=document.getElementById('noResults');
      if(filteredCoupons.length===0){
        grid.innerHTML='';
        empty.classList.add('show');
        return;
      }
      empty.classList.remove('show');
      grid.innerHTML = filteredCoupons.map(c=>{
        const isSaved=savedCoupons.includes(c.id);
        const store=c[`store_${currentLang}`]||c['store_zh-tw']||c.store_ko||c.store_en||'';
        const offer=c[`offer_${currentLang}`]||c.offer||c.offer_en||'';
        const desc=c[`description_${currentLang}`]||c.description_ko||c.description_en||'';
        const area=c[`area_${currentLang}`]||c.area_ko||c.area_en||'';
        const days=getDaysLeft(c.expiry);
        const badgeText = days===0 ? translations[currentLang].expires_today : `${days} ${translations[currentLang].days_left}`;
        const badge = (days<=7 && days!==999) ? `<div class="expiry-badge">üî• ${esc(badgeText)}</div>` : '';
        return `
          <div class="coupon-card" tabindex="0" role="button" aria-label="${esc(store)} - ${esc(offer)}"
               onclick="showModal(${c.id})"
               onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();showModal(${c.id});}">
            ${badge}
            <img src="${esc(c.image)}" alt="${esc(store)}" loading="lazy"/>
            <div class="coupon-body">
              <div class="coupon-title">${esc(store)}</div>
              <div class="coupon-offer">${esc(offer)}</div>
              <div class="coupon-desc">${esc(desc)}</div>
              <div class="coupon-footer">
                <span class="coupon-area">üìç ${esc(area)}</span>
                <button type="button" class="save-btn ${isSaved?'saved':''}"
                        onclick="event.stopPropagation();toggleSave(${c.id})">
                  ${isSaved?'‚≠ê':'‚òÜ'} ${translations[currentLang][isSaved?'unsave':'save']}
                </button>
              </div>
            </div>
          </div>`;
      }).join('');
      updateCategoryBadges();
    }

    // ========= ÌïÑÌÑ∞(OR Î∂ÄÎ∂ÑÏùºÏπò) =========
    function filterBySearch(q){
      const query=String(q||'').toLowerCase().trim();
      const tokens=query.length?query.split(/\s+/):[];
      const match=(c)=>{
        const store=(c[`store_${currentLang}`]||c['store_zh-tw']||c.store_ko||c.store_en||'').toLowerCase();
        const area=(c[`area_${currentLang}`]||c.area_ko||c.area_en||'').toLowerCase();
        const desc=(c[`description_${currentLang}`]||c.description_ko||c.description_en||'').toLowerCase();
        if(tokens.length===0) return true;
        return tokens.some(t=>store.includes(t)||area.includes(t)||desc.includes(t));
      };
      if(currentCategory==='saved'){
        filteredCoupons=couponsData.filter(c=>savedCoupons.includes(c.id)&&match(c));
      }else if(currentCategory==='all'){
        filteredCoupons=couponsData.filter(match);
      }else{
        filteredCoupons=couponsData.filter(c=>c.category===currentCategory && match(c));
      }
      renderCoupons();
    }
    function filterByCategory(cat){
      currentCategory=cat;
      const val=document.getElementById('searchInput').value;
      if(cat==='all'){filteredCoupons=[...couponsData]}
      else if(cat==='saved'){filteredCoupons=couponsData.filter(c=>savedCoupons.includes(c.id))}
      else{filteredCoupons=couponsData.filter(c=>c.category===cat)}
      val?filterBySearch(val):renderCoupons();
    }

    // ========= Ï†ÄÏû• =========
    function toggleSave(id){
      if(savedCoupons.includes(id)){savedCoupons=savedCoupons.filter(x=>x!==id)}
      else{savedCoupons.push(id)}
      localStorage.setItem('savedCoupons',JSON.stringify(savedCoupons));
      updateSavedInfo(); updateCategoryBadges(); renderCoupons();
    }
    function updateSavedInfo(){
      const info=document.getElementById('savedInfo');
      const count=document.getElementById('savedCount');
      const badge=document.getElementById('savedBadge');
      const n=savedCoupons.length;
      if(n>0){info.classList.add('show'); count.textContent=n; badge.textContent=n;}
      else{info.classList.remove('show'); badge.textContent='0';}
    }

    // ========= Î™®Îã¨(Ïù¥ÎØ∏ÏßÄ) =========
    function showModal(id){
      const c=couponsData.find(x=>x.id===id); if(!c) return;
      _lastFocused=document.activeElement;
      const modal=document.getElementById('modal'); const body=document.getElementById('modalBody');

      const store=c[`store_${currentLang}`]||c['store_zh-tw']||c.store_ko||c.store_en||'';
      const offer=c[`offer_${currentLang}`]||c.offer||c.offer_en||'';
      const area=c[`area_${currentLang}`]||c.area_ko||c.area_en||'';
      const terms=(c[`terms_${currentLang}`]||c.terms_ko||c.terms_en||'').split('|').map(s=>s.trim()).filter(Boolean);
      const days=getDaysLeft(c.expiry);
      const badgeText= days===999 ? translations[currentLang].no_expiry
                     : (days===0 ? translations[currentLang].expires_today : `${days} ${translations[currentLang].days_left}`);
      const expiry = c.expiry ? `${c.expiry} (${badgeText})` : translations[currentLang].no_expiry;

      body.innerHTML=`
        <div class="modal-title" id="modalTitle">${esc(store)}</div>
        <div class="modal-offer">${esc(offer)}</div>
        <div class="coupon-image-box">
          <img class="coupon-image" src="${esc(c.coupon_image||c.image)}" alt="${esc(store)} coupon"/>
        </div>
        <div class="share-section" style="display:flex;gap:12px;justify-content:space-between;margin:8px 0 16px;">
          <a class="btn btn-secondary" href="${esc(c.coupon_image||c.image)}" target="_blank" rel="noopener" >
            üñºÔ∏è ${translations[currentLang].view_image}
          </a>
          <a class="btn btn-primary" href="${esc(c.coupon_image||c.image)}" download>
            ‚¨áÔ∏è ${translations[currentLang].download_image}
          </a>
          <button type="button" class="btn btn-secondary" onclick="shareCoupon('${id}')">üì§ ${translations[currentLang].share}</button>
        </div>
        ${(c.article_url||c.official_url||c.maps_url)?`
        <div class="links-section">
          ${c.article_url?`<a class="link-item" target="_blank" rel="noopener" href="${esc(c.article_url)}"><span>üì∞ ${translations[currentLang].view_article}</span><span>‚Üí</span></a>`:''}
          ${c.official_url?`<a class="link-item" target="_blank" rel="noopener" href="${esc(c.official_url)}"><span>üåê ${translations[currentLang].visit_website}</span><span>‚Üí</span></a>`:''}
          ${c.maps_url?`<a class="link-item" target="_blank" rel="noopener" href="${esc(c.maps_url)}"><span>üìç ${translations[currentLang].view_map}</span><span>‚Üí</span></a>`:''}
        </div>`:''}
        ${terms.length?`
        <div class="modal-section">
          <h3>${translations[currentLang].terms}</h3>
          <ul>${terms.map(t=>`<li>${esc(t)}</li>`).join('')}</ul>
        </div>`:''}
        <div class="modal-info">üìç ${esc(area)}</div>
        <div class="modal-info">üìÖ ${translations[currentLang].expiry}: ${esc(expiry)}</div>
        <button type="button" class="btn btn-secondary close-modal-btn" onclick="closeModal()">${translations[currentLang].close}</button>
      `;

      modal.classList.add('show'); modal.removeAttribute('aria-hidden'); document.body.style.overflow='hidden';
      // focus trap
      const focusables=modal.querySelectorAll('button,[href],[tabindex]:not([tabindex="-1"])');
      const first=focusables[0], last=focusables[focusables.length-1];
      if(first) first.focus();
      _trapHandler=function(e){
        if(e.key!=='Tab') return;
        if(e.shiftKey && document.activeElement===first){e.preventDefault(); last.focus();}
        else if(!e.shiftKey && document.activeElement===last){e.preventDefault(); first.focus();}
      };
      modal.addEventListener('keydown',_trapHandler);
    }
    function closeModal(){
      const modal=document.getElementById('modal');
      modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); document.body.style.overflow='';
      if(_trapHandler){modal.removeEventListener('keydown',_trapHandler); _trapHandler=null;}
      if(_lastFocused) _lastFocused.focus();
    }

    // ========= Í≥µÏú† =========
    async function shareCoupon(id){
      const c=couponsData.find(x=>x.id===parseInt(id)); if(!c) return;
      const store=c[`store_${currentLang}`]||c.store_ko||c.store_en||'';
      const url=`${location.origin}${location.pathname}?coupon=${id}&lang=${currentLang}`;
      const data={title:store,text:store,url};
      try{
        if(navigator.share){await navigator.share(data);}
        else{
          await navigator.clipboard.writeText(url);
          alert(translations[currentLang].copied);
        }
      }catch(e){console.log('share failed',e);}
    }

    // ========= Ïù¥Î≤§Ìä∏/Ï¥àÍ∏∞Ìôî =========
    function setupEvents(){
      const input=document.getElementById('searchInput');
      input.addEventListener('input',e=>{ clearTimeout(_searchTimer); _searchTimer=setTimeout(()=>filterBySearch(e.target.value),120); });
      document.querySelectorAll('.tab').forEach(tab=>{
        tab.addEventListener('click',()=>{ document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); tab.classList.add('active'); filterByCategory(tab.dataset.category); });
      });
      document.getElementById('langSelect').addEventListener('change',e=>{
        currentLang=e.target.value; localStorage.setItem('selectedLang',currentLang); document.documentElement.lang=currentLang; updateLanguage(); renderCoupons();
      });
      document.getElementById('modal').addEventListener('click',e=>{ if(e.target.id==='modal') closeModal(); });
      document.addEventListener('keydown',e=>{ if(e.key==='Escape') closeModal(); });
    }

    function applyDeepLink(){
      const p=new URLSearchParams(location.search);
      const lang=p.get('lang'); const id=parseInt(p.get('coupon'),10);
      if(lang && ['ko','en','zh','zh-tw','th','id'].includes(lang)){
        currentLang=lang; localStorage.setItem('selectedLang',lang); document.documentElement.lang=lang;
        const sel=document.getElementById('langSelect'); if(sel) sel.value=lang; updateLanguage();
      }
      if(id) showModal(id);
    }

    document.addEventListener('DOMContentLoaded',()=>{
      detectLanguage(); updateLanguage(); renderCoupons(); updateSavedInfo(); updateCategoryBadges(); setupEvents(); applyDeepLink();
    });
  </script>
</body>
</html>
