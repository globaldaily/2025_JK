<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JAPANKURU Wallet</title>
  
  <style>
    /* ===== Apple Design System ===== */
    :root {
      --primary: #007AFF;
      --secondary: #5856D6;
      --success: #34C759;
      --warning: #FF9500;
      --danger: #FF3B30;
      
      --gray-50: #F2F2F7;
      --gray-100: #E5E5EA;
      --gray-200: #D1D1D6;
      --gray-300: #C7C7CC;
      --gray-400: #AEAEB2;
      --gray-500: #8E8E93;
      --gray-600: #636366;
      --gray-700: #48484A;
      --gray-800: #2C2C2E;
      --gray-900: #1C1C1E;
      
      --bg: #FFFFFF;
      --surface: #F2F2F7;
      --text: #000000;
      --text-secondary: #8E8E93;
      
      --radius: 20px;
      --radius-sm: 12px;
      --radius-xs: 8px;
      
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
      --shadow: 0 4px 12px rgba(0,0,0,0.08);
      --shadow-lg: 0 10px 40px rgba(0,0,0,0.12);
      
      --font: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", "Helvetica Neue", sans-serif;
    }
    
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #000000;
        --surface: #1C1C1E;
        --text: #FFFFFF;
        --text-secondary: #8E8E93;
        --gray-50: #1C1C1E;
        --gray-100: #2C2C2E;
      }
    }
    
    /* ===== ë¦¬ì…‹ ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: var(--font);
      background: var(--surface);
      color: var(--text);
      line-height: 1.5;
      font-size: 17px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* ===== ë ˆì´ì•„ì›ƒ ===== */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    /* ===== í—¤ë” (Apple ìŠ¤íƒ€ì¼) ===== */
    header {
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 0.5px solid var(--gray-200);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    @media (prefers-color-scheme: dark) {
      header {
        background: rgba(28,28,30,0.8);
      }
    }
    
    .header-inner {
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 52px;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      color: var(--text);
      font-weight: 600;
      font-size: 19px;
    }
    
    .logo img {
      height: 28px;
      width: auto;
    }
    
    /* ===== ì–¸ì–´ ì„ íƒ (Apple ìŠ¤íƒ€ì¼) ===== */
    .lang-select {
      padding: 6px 12px;
      border: none;
      border-radius: var(--radius-xs);
      background: var(--gray-100);
      color: var(--text);
      font-size: 15px;
      cursor: pointer;
      font-family: inherit;
      min-width: 120px;
      transition: all 0.2s;
    }
    
    .lang-select:hover {
      background: var(--gray-200);
    }
    
    .lang-select:focus {
      outline: none;
      box-shadow: 0 0 0 4px rgba(0,122,255,0.3);
    }
    
    /* ===== íˆì–´ë¡œ ì„¹ì…˜ (Apple ìŠ¤íƒ€ì¼) ===== */
    .hero {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 60px 40px;
      border-radius: var(--radius);
      margin: 30px 0;
      text-align: center;
    }
    
    .hero h1 {
      font-size: 48px;
      font-weight: 700;
      margin-bottom: 12px;
      letter-spacing: -0.02em;
    }
    
    .hero p {
      font-size: 21px;
      opacity: 0.95;
      font-weight: 400;
    }
    
    @media (max-width: 768px) {
      .hero {
        padding: 40px 20px;
      }
      .hero h1 {
        font-size: 32px;
      }
      .hero p {
        font-size: 17px;
      }
    }
    
    /* ===== ê²€ìƒ‰ë°” (Apple ìŠ¤íƒ€ì¼) ===== */
    .search-bar {
      margin-bottom: 30px;
    }
    
    .search-input {
      width: 100%;
      padding: 16px 20px;
      padding-left: 48px;
      border: none;
      border-radius: var(--radius-sm);
      background: var(--bg);
      font-size: 17px;
      transition: all 0.2s;
      box-shadow: var(--shadow);
    }
    
    .search-wrapper {
      position: relative;
    }
    
    .search-icon {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray-400);
      pointer-events: none;
    }
    
    .search-input:focus {
      outline: none;
      box-shadow: 0 0 0 4px rgba(0,122,255,0.3);
    }
    
    .search-input::placeholder {
      color: var(--gray-400);
    }
    
    /* ===== ì¹´í…Œê³ ë¦¬ íƒ­ (Apple ìŠ¤íƒ€ì¼) ===== */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      overflow-x: auto;
      padding-bottom: 10px;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    
    .tabs::-webkit-scrollbar {
      display: none;
    }
    
    .tab {
      padding: 10px 20px;
      border: none;
      background: var(--bg);
      border-radius: 100px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
      white-space: nowrap;
      transition: all 0.2s;
      box-shadow: var(--shadow-sm);
      color: var(--text);
      font-family: inherit;
    }
    
    .tab:hover {
      transform: scale(1.05);
      box-shadow: var(--shadow);
    }
    
    .tab.active {
      background: var(--primary);
      color: white;
      box-shadow: 0 4px 12px rgba(0,122,255,0.3);
    }
    
    .tab .badge {
      display: inline-block;
      background: rgba(0,0,0,0.1);
      padding: 2px 8px;
      border-radius: 100px;
      font-size: 12px;
      margin-left: 6px;
      font-weight: 600;
    }
    
    .tab.active .badge {
      background: rgba(255,255,255,0.3);
    }
    
    /* ===== ì¿ í° ê·¸ë¦¬ë“œ ===== */
    .coupon-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 24px;
      margin-bottom: 60px;
    }
    
    @media (max-width: 768px) {
      .coupon-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
    }
    
    /* ===== ì¿ í° ì¹´ë“œ (Apple ìŠ¤íƒ€ì¼) ===== */
    .coupon-card {
      background: var(--bg);
      border-radius: var(--radius-sm);
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      cursor: pointer;
      position: relative;
    }
    
    .coupon-card:hover {
      transform: translateY(-8px);
      box-shadow: var(--shadow-lg);
    }
    
    .coupon-card:focus {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }
    
    .coupon-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }
    
    /* ë§Œë£Œ ì„ë°• ë°°ì§€ */
    .expiry-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      background: var(--danger);
      color: white;
      padding: 6px 12px;
      border-radius: 100px;
      font-size: 13px;
      font-weight: 600;
      box-shadow: var(--shadow);
    }
    
    .coupon-body {
      padding: 20px;
    }
    
    .coupon-title {
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 8px;
      letter-spacing: -0.01em;
    }
    
    .coupon-offer {
      font-size: 28px;
      color: var(--danger);
      font-weight: 700;
      margin-bottom: 12px;
    }
    
    .coupon-desc {
      font-size: 15px;
      color: var(--text-secondary);
      margin-bottom: 16px;
      line-height: 1.4;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    
    .coupon-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 16px;
      border-top: 1px solid var(--gray-100);
    }
    
    .coupon-area {
      font-size: 14px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    /* ===== ì €ì¥ ë²„íŠ¼ (Apple ìŠ¤íƒ€ì¼) ===== */
    .save-btn {
      padding: 8px 16px;
      border: none;
      background: var(--gray-100);
      border-radius: 100px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 4px;
      font-family: inherit;
    }
    
    .save-btn:hover {
      background: var(--gray-200);
      transform: scale(1.05);
    }
    
    .save-btn.saved {
      background: var(--warning);
      color: white;
    }
    
    .save-btn.saved:hover {
      background: #FF8800;
    }
    
    /* ===== ëª¨ë‹¬ (Apple ìŠ¤íƒ€ì¼) ===== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.4);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      z-index: 1000;
      padding: 20px;
      overflow-y: auto;
    }
    
    .modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .modal-content {
      background: var(--bg);
      border-radius: var(--radius);
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      animation: slideUp 0.3s;
      box-shadow: var(--shadow-lg);
    }
    
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .modal-body {
      padding: 30px;
    }
    
    .modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 36px;
      height: 36px;
      border: none;
      background: var(--gray-100);
      border-radius: 50%;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      color: var(--text);
    }
    
    .modal-close:hover {
      background: var(--gray-200);
      transform: scale(1.1);
    }
    
    .modal-title {
      font-size: 28px;
      font-weight: 600;
      margin-bottom: 8px;
      padding-right: 40px;
      letter-spacing: -0.02em;
    }
    
    .modal-offer {
      font-size: 36px;
      color: var(--danger);
      font-weight: 700;
      margin-bottom: 24px;
    }
    
    .coupon-code-box {
      background: var(--surface);
      padding: 24px;
      border-radius: var(--radius-sm);
      text-align: center;
      margin-bottom: 24px;
    }
    
    .coupon-code {
      font-size: 32px;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-weight: 600;
      margin-bottom: 16px;
      letter-spacing: 0.05em;
    }
    
    /* ===== ë²„íŠ¼ (Apple ìŠ¤íƒ€ì¼) ===== */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 100px;
      font-size: 17px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      min-width: 120px;
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background: #0051D5;
      transform: scale(1.05);
    }
    
    .btn-secondary {
      background: var(--gray-100);
      color: var(--text);
    }
    
    .btn-secondary:hover {
      background: var(--gray-200);
      transform: scale(1.05);
    }
    
    .btn.copied {
      background: var(--success);
      color: white;
    }
    
    /* ===== ë§í¬ ì„¹ì…˜ (ìƒˆë¡œ ì¶”ê°€) ===== */
    .links-section {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin: 24px 0;
      padding: 20px;
      background: var(--surface);
      border-radius: var(--radius-sm);
    }
    
    .link-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--bg);
      border-radius: var(--radius-xs);
      text-decoration: none;
      color: var(--text);
      transition: all 0.2s;
      border: 1px solid var(--gray-100);
    }
    
    .link-item:hover {
      background: var(--gray-50);
      transform: translateX(4px);
      box-shadow: var(--shadow-sm);
    }
    
    .link-label {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 15px;
      font-weight: 500;
    }
    
    .link-arrow {
      color: var(--gray-400);
      font-size: 14px;
    }
    
    /* ===== ëª¨ë‹¬ ì„¹ì…˜ ===== */
    .modal-section {
      margin-bottom: 24px;
    }
    
    .modal-section h3 {
      font-size: 17px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text-secondary);
    }
    
    .modal-section ul {
      list-style: none;
      padding: 0;
    }
    
    .modal-section li {
      font-size: 15px;
      color: var(--text);
      margin-bottom: 8px;
      padding-left: 20px;
      position: relative;
      line-height: 1.5;
    }
    
    .modal-section li:before {
      content: "â€¢";
      position: absolute;
      left: 8px;
      color: var(--gray-400);
    }
    
    .modal-info {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 15px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }
    
    .close-modal-btn {
      width: 100%;
      margin-top: 24px;
    }
    
    /* ===== ì €ì¥ ì •ë³´ ë°°ë„ˆ ===== */
    .saved-info {
      background: linear-gradient(135deg, var(--warning), #FF8800);
      color: white;
      padding: 16px 20px;
      border-radius: var(--radius-sm);
      margin-bottom: 24px;
      display: none;
      font-weight: 500;
      box-shadow: var(--shadow);
    }
    
    .saved-info.show {
      display: block;
    }
    
    /* ===== ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ ===== */
    .no-results {
      text-align: center;
      padding: 80px 20px;
      display: none;
    }
    
    .no-results.show {
      display: block;
    }
    
    .no-results-icon {
      font-size: 72px;
      margin-bottom: 20px;
      opacity: 0.5;
    }
    
    .no-results h3 {
      font-size: 24px;
      margin-bottom: 12px;
      font-weight: 600;
    }
    
    .no-results p {
      color: var(--text-secondary);
      font-size: 17px;
    }
    
    /* ===== ê³µìœ  ë²„íŠ¼ ì„¹ì…˜ ===== */
    .share-section {
      display: flex;
      gap: 12px;
      margin: 20px 0;
    }
    
    .share-btn {
      flex: 1;
    }
    
    /* ===== ë°˜ì‘í˜• ===== */
    @media (max-width: 640px) {
      .modal-content {
        margin: 20px;
        max-height: calc(100vh - 40px);
      }
      
      .tabs {
        padding: 0 20px 10px;
        margin: 0 -20px 30px;
      }
    }
  </style>
</head>
<body>

  <!-- í—¤ë” -->
  <header>
    <div class="container">
      <div class="header-inner">
        <a href="/" class="logo">
          <img src="https://japankuru.com/gld-kanri/data/themes/japankuru/assets/images/logo.svg" alt="Japankuru">
          <span>Wallet</span>
        </a>
        <select id="langSelect" class="lang-select" aria-label="Language">
          <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
          <option value="en">ğŸ‡ºğŸ‡¸ English</option>
          <option value="zh">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</option>
          <option value="zh-tw">ğŸ‡¹ğŸ‡¼ ç¹é«”ä¸­æ–‡</option>
          <option value="th">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</option>
          <option value="id">ğŸ‡®ğŸ‡© Indonesia</option>
        </select>
      </div>
    </div>
  </header>

  <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
  <div class="container">
    
    <!-- íˆì–´ë¡œ ì„¹ì…˜ -->
    <div class="hero">
      <h1 data-i18n="hero_title">ì¼ë³¸ ì—¬í–‰ í• ì¸ ì¿ í°</h1>
      <p data-i18n="hero_desc">ì¸ê¸° ë§¤ì¥ì—ì„œ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ í• ì¸ ì¿ í°</p>
    </div>

    <!-- ê²€ìƒ‰ë°” -->
    <div class="search-bar">
      <div class="search-wrapper">
        <span class="search-icon">ğŸ”</span>
        <input type="search" 
               id="searchInput" 
               class="search-input"
               placeholder="ë§¤ì¥ëª…, ì§€ì—­ìœ¼ë¡œ ê²€ìƒ‰..."
               data-i18n-placeholder="search_placeholder">
      </div>
    </div>

    <!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
    <div class="tabs" id="categoryTabs">
      <button type="button" class="tab active" data-category="all">
        <span data-i18n="cat_all">ì „ì²´</span> <span class="badge">0</span>
      </button>
      <button type="button" class="tab" data-category="electronics">
        <span>ğŸ”Œ</span> <span data-i18n="cat_electronics">ì „ìì œí’ˆ</span> <span class="badge">0</span>
      </button>
      <button type="button" class="tab" data-category="fashion">
        <span>ğŸ‘•</span> <span data-i18n="cat_fashion">íŒ¨ì…˜</span> <span class="badge">0</span>
      </button>
      <button type="button" class="tab" data-category="dining">
        <span>ğŸ½ï¸</span> <span data-i18n="cat_dining">ë§›ì§‘</span> <span class="badge">0</span>
      </button>
      <button type="button" class="tab" data-category="transport">
        <span>ğŸš‡</span> <span data-i18n="cat_transport">êµí†µ</span> <span class="badge">0</span>
      </button>
      <button type="button" class="tab" data-category="saved">
        <span>â­</span> <span data-i18n="cat_saved">ì €ì¥ë¨</span> <span class="badge" id="savedBadge">0</span>
      </button>
    </div>

    <!-- ì €ì¥ëœ ì¿ í° ì •ë³´ -->
    <div class="saved-info" id="savedInfo">
      <span data-i18n="saved_info">ì €ì¥ëœ ì¿ í°</span> <strong id="savedCount">0</strong><span data-i18n="saved_unit">ê°œ</span>
    </div>

    <!-- ì¿ í° ê·¸ë¦¬ë“œ -->
    <div class="coupon-grid" id="couponGrid">
      <!-- ì¿ í° ì¹´ë“œë“¤ì´ ì—¬ê¸° ë™ì  ìƒì„±ë¨ -->
    </div>

    <!-- ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ -->
    <div class="no-results" id="noResults">
      <div class="no-results-icon">ğŸ”</div>
      <h3 data-i18n="no_results">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
      <p data-i18n="no_results_desc">ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”</p>
    </div>
  </div>

  <!-- ëª¨ë‹¬ -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <button type="button" class="modal-close" onclick="closeModal()" aria-label="Close">Ã—</button>
      <div class="modal-body" id="modalBody">
        <!-- ëª¨ë‹¬ ë‚´ìš©ì´ ì—¬ê¸° ë™ì  ìƒì„±ë¨ -->
      </div>
    </div>
  </div>

  <script>
    // ====== WordPress í†µí•© ê°€ì´ë“œ ======
    // PHPì—ì„œ ì´ë ‡ê²Œ ë°ì´í„°ë¥¼ ì£¼ì…í•©ë‹ˆë‹¤:
    // const couponsData = <?php echo json_encode($wordpress_coupons); ?>;
    
    // ====== ê°œë°œìš© ìƒ˜í”Œ ë°ì´í„° (ì‹¤ì œ ìš´ì˜ì‹œ WordPressì—ì„œ ìë™ ì£¼ì…) ======
    const couponsData = [
      {
        id: 1,
        // ë‹¤êµ­ì–´ ë§¤ì¥ëª…
        store_ko: 'ì½”ì§€ë§ˆ x ë¹…ì¹´ë©”ë¼',
        store_en: 'Kojima x BicCamera',
        store_zh: 'å°å²› x Bic Camera',
        store_zh_tw: 'å°å³¶ x Bic Camera',
        store_th: 'à¹‚à¸„à¸ˆà¸´à¸¡à¸° x à¸šà¸´à¸à¸„à¸²à¹€à¸¡à¸£à¹ˆà¸²',
        store_id: 'Kojima x BicCamera',
        // í• ì¸ ì •ë³´
        offer: 'ìµœëŒ€ 17% OFF',
        offer_en: 'Up to 17% OFF',
        offer_zh: 'æœ€å¤§17%æŠ˜æ‰£',
        offer_zh_tw: 'æœ€å¤§17%æŠ˜æ‰£',
        offer_th: 'à¸¥à¸”à¸ªà¸¹à¸‡à¸ªà¸¸à¸” 17%',
        offer_id: 'Diskon hingga 17%',
        // ì„¤ëª…
        description_ko: 'ë©´ì„¸ 10% + ì¶”ê°€ 7% í• ì¸! ìµœì‹  ì „ìì œí’ˆì„ ì €ë ´í•˜ê²Œ.',
        description_en: 'Tax-free 10% + Additional 7% discount!',
        description_zh: 'å…ç¨10% + é¢å¤–7%æŠ˜æ‰£ï¼',
        description_zh_tw: 'å…ç¨…10% + é¡å¤–7%æŠ˜æ‰£ï¼',
        description_th: 'à¸›à¸¥à¸­à¸”à¸ à¸²à¸©à¸µ 10% + à¸ªà¹ˆà¸§à¸™à¸¥à¸”à¹€à¸à¸´à¹ˆà¸¡ 7%!',
        description_id: 'Bebas pajak 10% + Diskon tambahan 7%!',
        // ê¸°ë³¸ ì •ë³´
        category: 'electronics',
        expiry: '2025-12-31',
        image: 'https://japankuru.com/gld-kanri/data/uploads/2023/11/kojima%E8%8B%B1%E8%AA%9E%E7%89%88%E4%BC%81%E6%A5%AD%E6%9C%89_kojima_EN_B-2.jpg',
        code: 'JK-BIC2025',
        // ì§€ì—­
        area_ko: 'ì•„í‚¤í•˜ë°”ë¼',
        area_en: 'Akihabara',
        area_zh: 'ç§‹å¶åŸ',
        area_zh_tw: 'ç§‹è‘‰åŸ',
        area_th: 'à¸­à¸²à¸à¸´à¸®à¸²à¸šà¸²à¸£à¸°',
        area_id: 'Akihabara',
        // ì´ìš©ì¡°ê±´
        terms_ko: 'íƒ€ í• ì¸ê³¼ ì¤‘ë³µ ë¶ˆê°€|ì¼ë¶€ í’ˆëª© ì œì™¸|ê³„ì‚° ì „ ì œì‹œ|1ì¸ 1íšŒ',
        terms_en: 'Cannot combine|Some items excluded|Show before payment|Once per person',
        terms_zh: 'ä¸å¯ä¸å…¶ä»–ä¼˜æƒ åŒæ—¶ä½¿ç”¨|éƒ¨åˆ†å•†å“é™¤å¤–|ç»“è´¦å‰å‡ºç¤º|æ¯äººé™ä¸€æ¬¡',
        terms_zh_tw: 'ä¸å¯èˆ‡å…¶ä»–å„ªæƒ åŒæ™‚ä½¿ç”¨|éƒ¨åˆ†å•†å“é™¤å¤–|çµå¸³å‰å‡ºç¤º|æ¯äººé™ä¸€æ¬¡',
        terms_th: 'à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹ƒà¸Šà¹‰à¸£à¹ˆà¸§à¸¡à¸à¸±à¸šà¸ªà¹ˆà¸§à¸™à¸¥à¸”à¸­à¸·à¹ˆà¸™|à¸¢à¸à¹€à¸§à¹‰à¸™à¸šà¸²à¸‡à¸£à¸²à¸¢à¸à¸²à¸£|à¹à¸ªà¸”à¸‡à¸à¹ˆà¸­à¸™à¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™|à¸«à¸™à¸¶à¹ˆà¸‡à¸„à¸£à¸±à¹‰à¸‡à¸•à¹ˆà¸­à¸„à¸™',
        terms_id: 'Tidak dapat digabung dengan diskon lain|Beberapa item dikecualikan|Tunjukkan sebelum pembayaran|Sekali per orang',
        // ë§í¬ë“¤
        article_url: 'https://www.japankuru.com/en/e2290.html',
        official_url: 'https://www.biccamera.com',
        maps_url: 'https://maps.google.com/?q=35.6909,139.7003'
      },
      {
        id: 2,
        store_ko: 'ì§„ìŠ¤ (JINS)',
        store_en: 'JINS',
        store_zh: 'JINS',
        store_zh_tw: 'JINS',
        store_th: 'à¸ˆà¸´à¸™à¸ªà¹Œ',
        store_id: 'JINS',
        offer: '10% OFF',
        offer_en: '10% OFF',
        offer_zh: '10%æŠ˜æ‰£',
        offer_zh_tw: '10%æŠ˜æ‰£',
        offer_th: 'à¸¥à¸” 10%',
        offer_id: 'Diskon 10%',
        description_ko: 'ë©´ì„¸+í• ì¸ ì•ˆê²½.',
        description_en: 'Tax-free + discount glasses.',
        description_zh: 'å…ç¨+æŠ˜æ‰£çœ¼é•œã€‚',
        description_zh_tw: 'å…ç¨…+æŠ˜æ‰£çœ¼é¡ã€‚',
        description_th: 'à¹à¸§à¹ˆà¸™à¸•à¸²à¸›à¸¥à¸­à¸”à¸ à¸²à¸©à¸µ+à¸ªà¹ˆà¸§à¸™à¸¥à¸”',
        description_id: 'Kacamata bebas pajak + diskon.',
        category: 'fashion',
        expiry: '2025-02-05',
        image: 'https://japankuru.com/gld-kanri/data/uploads/2024/06/japankuru_1800-1200-1536x1024.jpg',
        code: 'JK-JINS2025',
        area_ko: 'ì‹œë¶€ì•¼',
        area_en: 'Shibuya',
        area_zh: 'æ¶©è°·',
        area_zh_tw: 'æ¾€è°·',
        area_th: 'à¸Šà¸´à¸šà¸¹à¸¢à¹ˆà¸²',
        area_id: 'Shibuya',
        terms_ko: 'íƒ€ í• ì¸ê³¼ ì¤‘ë³µ ë¶ˆê°€|ì¼ë¶€ í’ˆëª© ì œì™¸',
        terms_en: 'Cannot combine|Some items excluded',
        terms_zh: 'ä¸å¯ä¸å…¶ä»–ä¼˜æƒ åŒæ—¶ä½¿ç”¨|éƒ¨åˆ†å•†å“é™¤å¤–',
        terms_zh_tw: 'ä¸å¯èˆ‡å…¶ä»–å„ªæƒ åŒæ™‚ä½¿ç”¨|éƒ¨åˆ†å•†å“é™¤å¤–',
        terms_th: 'à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹ƒà¸Šà¹‰à¸£à¹ˆà¸§à¸¡à¸à¸±à¸šà¸ªà¹ˆà¸§à¸™à¸¥à¸”à¸­à¸·à¹ˆà¸™|à¸¢à¸à¹€à¸§à¹‰à¸™à¸šà¸²à¸‡à¸£à¸²à¸¢à¸à¸²à¸£',
        terms_id: 'Tidak dapat digabung dengan diskon lain|Beberapa item dikecualikan',
        article_url: 'https://www.japankuru.com/en/e2291.html',
        official_url: 'https://www.jins.com',
        maps_url: 'https://maps.google.com/?q=35.6581,139.6986'
      },
      {
        id: 3,
        store_ko: 'BEAMS JAPAN',
        store_en: 'BEAMS JAPAN',
        store_zh: 'BEAMS JAPAN',
        store_zh_tw: 'BEAMS JAPAN',
        store_th: 'à¸šà¸µà¸¡à¸ªà¹Œ à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™',
        store_id: 'BEAMS JAPAN',
        offer: '5% ì¶”ê°€ í• ì¸',
        offer_en: '5% Extra OFF',
        category: 'fashion',
        expiry: '2025-09-30',
        image: 'https://img.japankuru.com/prg_img/img/img2024011517461371466800.jpg',
        code: 'JK-BEAMS25',
        area_ko: 'ì‹ ì£¼ì¿ ',
        area_en: 'Shinjuku',
        terms_ko: 'íƒ€ í• ì¸ê³¼ ì¤‘ë³µ ë¶ˆê°€',
        terms_en: 'Cannot combine with other discounts',
        article_url: 'https://www.japankuru.com/en/e2292.html',
        official_url: 'https://www.beams.co.jp',
        maps_url: 'https://maps.google.com/?q=35.6702,139.7073'
      },
      {
        id: 4,
        store_ko: 'ì‚¬ë¬´ë¼ì´ ë ˆìŠ¤í† ë‘',
        store_en: 'Samurai Restaurant',
        offer: 'ìŒë£Œ 1ì” ë¬´ë£Œ',
        offer_en: '1 Free Drink',
        category: 'dining',
        expiry: '2026-03-31',
        image: 'https://japankuru.com/gld-kanri/data/uploads/2024/06/%E4%BE%8D%E3%82%AF%E3%83%BC%E3%83%9D%E3%83%B3c-2_0_0-1536x864.jpeg',
        code: 'JK-SAMURAI',
        area_ko: 'ì‹ ì£¼ì¿ ',
        area_en: 'Shinjuku',
        terms_ko: 'ìŒë£ŒëŠ” ì†Œí”„íŠ¸ë“œë§í¬ í•œì •',
        terms_en: 'Soft drinks only',
        article_url: '',
        official_url: 'https://www.samurai-restaurant.com',
        maps_url: 'https://maps.google.com/?q=35.6947,139.7006'
      },
      {
        id: 5,
        store_ko: 'ë„íì„ ',
        store_en: 'Tokyu Line',
        offer: '1ì¼ ìŠ¹ì°¨ê¶Œ',
        offer_en: '1-Day Pass',
        category: 'transport',
        expiry: '9999-12-31',
        image: 'https://japankuru.com/gld-kanri/data/uploads/2025/03/tokyu-cover-16-9-1-1536x864.png',
        code: 'JK-TOKYU',
        area_ko: 'ì‹œë¶€ì•¼',
        area_en: 'Shibuya',
        terms_ko: 'ë‹¹ì¼ í•œì • ì‚¬ìš©',
        terms_en: 'Valid on day of use only',
        article_url: '',
        official_url: 'https://www.tokyu.co.jp',
        maps_url: ''
      },
      {
        id: 6,
        store_ko: 'ìš”ë„ë°”ì‹œì¹´ë©”ë¼',
        store_en: 'Yodobashi Camera',
        offer: 'ìµœëŒ€ 15% OFF',
        offer_en: 'Up to 15% OFF',
        category: 'electronics',
        expiry: '2025-11-30',
        image: 'https://img.japankuru.com/prg_img/thumbnail1/img2023112417190332724100.png',
        code: 'JK-YODOBASHI',
        area_ko: 'ì•„í‚¤í•˜ë°”ë¼',
        area_en: 'Akihabara',
        terms_ko: 'VISA ì¹´ë“œ ê²°ì œì‹œë§Œ ì ìš©',
        terms_en: 'VISA card payment only',
        article_url: '',
        official_url: 'https://www.yodobashi.com',
        maps_url: 'https://maps.google.com/?q=35.6938,139.7706'
      }
    ];

    // ====== ì „ì—­ ë³€ìˆ˜ ======
    let currentLang = 'ko';
    let savedCoupons = JSON.parse(localStorage.getItem('savedCoupons') || '[]');
    let filteredCoupons = [...couponsData];
    let currentCategory = 'all';
    let _lastFocused = null;
    let _trapHandler = null;
    let _searchTimer = null;

    // ====== ë²ˆì—­ (6ê°œ ì–¸ì–´) ======
    const translations = {
      ko: {
        hero_title: 'ì¼ë³¸ ì—¬í–‰ í• ì¸ ì¿ í°',
        hero_desc: 'ì¸ê¸° ë§¤ì¥ì—ì„œ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ í• ì¸ ì¿ í°',
        search_placeholder: 'ë§¤ì¥ëª…, ì§€ì—­ìœ¼ë¡œ ê²€ìƒ‰...',
        cat_all: 'ì „ì²´',
        cat_electronics: 'ì „ìì œí’ˆ',
        cat_fashion: 'íŒ¨ì…˜',
        cat_dining: 'ë§›ì§‘',
        cat_transport: 'êµí†µ',
        cat_saved: 'ì €ì¥ë¨',
        saved_info: 'ì €ì¥ëœ ì¿ í°',
        saved_unit: 'ê°œ',
        no_results: 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤',
        no_results_desc: 'ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”',
        save: 'ì €ì¥',
        unsave: 'ì €ì¥ í•´ì œ',
        copy: 'ì½”ë“œ ë³µì‚¬',
        copied: 'ë³µì‚¬ì™„ë£Œ!',
        close: 'ë‹«ê¸°',
        terms: 'ì´ìš©ì¡°ê±´',
        expiry: 'ìœ íš¨ê¸°í•œ',
        no_expiry: 'ë¬´ì œí•œ',
        share: 'ê³µìœ ',
        view_article: 'ê´€ë ¨ ê¸°ì‚¬',
        visit_website: 'ê³µì‹ í™ˆí˜ì´ì§€',
        view_map: 'ì§€ë„ ë³´ê¸°',
        days_left: 'ì¼ ë‚¨ìŒ',
        expires_today: 'ì˜¤ëŠ˜ ë§ˆê°'
      },
      en: {
        hero_title: 'Japan Travel Discount Coupons',
        hero_desc: 'Instant discounts at popular stores',
        search_placeholder: 'Search by store or area...',
        cat_all: 'All',
        cat_electronics: 'Electronics',
        cat_fashion: 'Fashion',
        cat_dining: 'Dining',
        cat_transport: 'Transport',
        cat_saved: 'Saved',
        saved_info: 'Saved coupons',
        saved_unit: '',
        no_results: 'No results found',
        no_results_desc: 'Try different search terms',
        save: 'Save',
        unsave: 'Unsave',
        copy: 'Copy Code',
        copied: 'Copied!',
        close: 'Close',
        terms: 'Terms',
        expiry: 'Expiry',
        no_expiry: 'No expiry',
        share: 'Share',
        view_article: 'Related Article',
        visit_website: 'Official Website',
        view_map: 'View Map',
        days_left: 'days left',
        expires_today: 'Ends today'
      },
      zh: {
        hero_title: 'æ—¥æœ¬æ—…è¡Œä¼˜æƒ åˆ¸',
        hero_desc: 'çƒ­é—¨å•†åº—å³æ—¶æŠ˜æ‰£',
        search_placeholder: 'æŒ‰åº—åæˆ–åœ°åŒºæœç´¢...',
        cat_all: 'å…¨éƒ¨',
        cat_electronics: 'ç”µå­äº§å“',
        cat_fashion: 'æ—¶å°š',
        cat_dining: 'ç¾é£Ÿ',
        cat_transport: 'äº¤é€š',
        cat_saved: 'å·²ä¿å­˜',
        saved_info: 'å·²ä¿å­˜çš„ä¼˜æƒ åˆ¸',
        saved_unit: 'å¼ ',
        no_results: 'æ²¡æœ‰æ‰¾åˆ°ç»“æœ',
        no_results_desc: 'å°è¯•å…¶ä»–æœç´¢è¯',
        save: 'ä¿å­˜',
        unsave: 'å–æ¶ˆä¿å­˜',
        copy: 'å¤åˆ¶ä»£ç ',
        copied: 'å·²å¤åˆ¶ï¼',
        close: 'å…³é—­',
        terms: 'ä½¿ç”¨æ¡æ¬¾',
        expiry: 'æœ‰æ•ˆæœŸ',
        no_expiry: 'æ— æœŸé™',
        share: 'åˆ†äº«',
        view_article: 'ç›¸å…³æ–‡ç« ',
        visit_website: 'å®˜æ–¹ç½‘ç«™',
        view_map: 'æŸ¥çœ‹åœ°å›¾',
        days_left: 'å¤©å‰©ä½™',
        expires_today: 'ä»Šå¤©åˆ°æœŸ'
      },
      'zh-tw': {
        hero_title: 'æ—¥æœ¬æ—…è¡Œå„ªæƒ åˆ¸',
        hero_desc: 'ç†±é–€å•†åº—å³æ™‚æŠ˜æ‰£',
        search_placeholder: 'æŒ‰åº—åæˆ–åœ°å€æœç´¢...',
        cat_all: 'å…¨éƒ¨',
        cat_electronics: 'é›»å­ç”¢å“',
        cat_fashion: 'æ™‚å°š',
        cat_dining: 'ç¾é£Ÿ',
        cat_transport: 'äº¤é€š',
        cat_saved: 'å·²ä¿å­˜',
        saved_info: 'å·²ä¿å­˜çš„å„ªæƒ åˆ¸',
        saved_unit: 'å¼µ',
        no_results: 'æ²’æœ‰æ‰¾åˆ°çµæœ',
        no_results_desc: 'å˜—è©¦å…¶ä»–æœç´¢è©',
        save: 'ä¿å­˜',
        unsave: 'å–æ¶ˆä¿å­˜',
        copy: 'è¤‡è£½ä»£ç¢¼',
        copied: 'å·²è¤‡è£½ï¼',
        close: 'é—œé–‰',
        terms: 'ä½¿ç”¨æ¢æ¬¾',
        expiry: 'æœ‰æ•ˆæœŸ',
        no_expiry: 'ç„¡æœŸé™',
        share: 'åˆ†äº«',
        view_article: 'ç›¸é—œæ–‡ç« ',
        visit_website: 'å®˜æ–¹ç¶²ç«™',
        view_map: 'æŸ¥çœ‹åœ°åœ–',
        days_left: 'å¤©å‰©é¤˜',
        expires_today: 'ä»Šå¤©åˆ°æœŸ'
      },
      th: {
        hero_title: 'à¸„à¸¹à¸›à¸­à¸‡à¸ªà¹ˆà¸§à¸™à¸¥à¸”à¸à¸²à¸£à¸—à¹ˆà¸­à¸‡à¹€à¸—à¸µà¹ˆà¸¢à¸§à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™',
        hero_desc: 'à¸ªà¹ˆà¸§à¸™à¸¥à¸”à¸—à¸±à¸™à¸—à¸µà¸—à¸µà¹ˆà¸£à¹‰à¸²à¸™à¸„à¹‰à¸²à¸¢à¸­à¸”à¸™à¸´à¸¢à¸¡',
        search_placeholder: 'à¸„à¹‰à¸™à¸«à¸²à¸•à¸²à¸¡à¸Šà¸·à¹ˆà¸­à¸£à¹‰à¸²à¸™à¸«à¸£à¸·à¸­à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆ...',
        cat_all: 'à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”',
        cat_electronics: 'à¸­à¸´à¹€à¸¥à¹‡à¸à¸—à¸£à¸­à¸™à¸´à¸à¸ªà¹Œ',
        cat_fashion: 'à¹à¸Ÿà¸Šà¸±à¹ˆà¸™',
        cat_dining: 'à¸­à¸²à¸«à¸²à¸£',
        cat_transport: 'à¸à¸²à¸£à¹€à¸”à¸´à¸™à¸—à¸²à¸‡',
        cat_saved: 'à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸¥à¹‰à¸§',
        saved_info: 'à¸„à¸¹à¸›à¸­à¸‡à¸—à¸µà¹ˆà¸šà¸±à¸™à¸—à¸¶à¸',
        saved_unit: 'à¹ƒà¸š',
        no_results: 'à¹„à¸¡à¹ˆà¸à¸šà¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ',
        no_results_desc: 'à¸¥à¸­à¸‡à¸„à¸³à¸„à¹‰à¸™à¸«à¸²à¸­à¸·à¹ˆà¸™',
        save: 'à¸šà¸±à¸™à¸—à¸¶à¸',
        unsave: 'à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸šà¸±à¸™à¸—à¸¶à¸',
        copy: 'à¸„à¸±à¸”à¸¥à¸­à¸à¹‚à¸„à¹‰à¸”',
        copied: 'à¸„à¸±à¸”à¸¥à¸­à¸à¹à¸¥à¹‰à¸§!',
        close: 'à¸›à¸´à¸”',
        terms: 'à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚',
        expiry: 'à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸',
        no_expiry: 'à¹„à¸¡à¹ˆà¸¡à¸µà¸à¸³à¸«à¸™à¸”',
        share: 'à¹à¸Šà¸£à¹Œ',
        view_article: 'à¸šà¸—à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡',
        visit_website: 'à¹€à¸§à¹‡à¸šà¹„à¸‹à¸•à¹Œà¸­à¸¢à¹ˆà¸²à¸‡à¹€à¸›à¹‡à¸™à¸—à¸²à¸‡à¸à¸²à¸£',
        view_map: 'à¸”à¸¹à¹à¸œà¸™à¸—à¸µà¹ˆ',
        days_left: 'à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸«à¸¥à¸·à¸­',
        expires_today: 'à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸à¸§à¸±à¸™à¸™à¸µà¹‰'
      },
      id: {
        hero_title: 'Kupon Diskon Perjalanan Jepang',
        hero_desc: 'Diskon instan di toko-toko populer',
        search_placeholder: 'Cari berdasarkan nama toko atau area...',
        cat_all: 'Semua',
        cat_electronics: 'Elektronik',
        cat_fashion: 'Fashion',
        cat_dining: 'Kuliner',
        cat_transport: 'Transportasi',
        cat_saved: 'Tersimpan',
        saved_info: 'Kupon tersimpan',
        saved_unit: '',
        no_results: 'Tidak ada hasil',
        no_results_desc: 'Coba kata kunci lain',
        save: 'Simpan',
        unsave: 'Batal simpan',
        copy: 'Salin Kode',
        copied: 'Tersalin!',
        close: 'Tutup',
        terms: 'Syarat',
        expiry: 'Berlaku hingga',
        no_expiry: 'Tidak terbatas',
        share: 'Bagikan',
        view_article: 'Artikel Terkait',
        visit_website: 'Situs Resmi',
        view_map: 'Lihat Peta',
        days_left: 'hari tersisa',
        expires_today: 'Berakhir hari ini'
      }
    };

    // ====== ìœ í‹¸: ì•ˆì „í•œ ë¬¸ìì—´ ì´ìŠ¤ì¼€ì´í”„ ======
    function esc(s){
      return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    // ====== ì´ˆê¸°í™” ======
    document.addEventListener('DOMContentLoaded', () => {
      // ì–¸ì–´ ê°ì§€
      detectLanguage();
      updateLanguage();

      // ë°ì´í„° ë Œë”ë§
      renderCoupons();
      updateSavedInfo();
      updateCategoryBadges();

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      setupEventListeners();

      // ëª¨ë‹¬ ì ‘ê·¼ì„± ì„¤ì •
      const modalContent = document.querySelector('.modal-content');
      if (modalContent) {
        modalContent.setAttribute('role', 'dialog');
        modalContent.setAttribute('aria-modal', 'true');
      }
      
      // ESC í‚¤ ë‹«ê¸°
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeModal();
      });

      // ë”¥ë§í¬ ì ìš© (?coupon=&lang=)
      applyDeepLink();
    });

    // ====== ì–¸ì–´ ê°ì§€ ======
    function detectLanguage() {
      const saved = localStorage.getItem('selectedLang');
      if (saved && ['ko', 'en', 'zh', 'zh-tw', 'th', 'id'].includes(saved)) {
        currentLang = saved;
      } else {
        const browserLang = navigator.language.slice(0, 2);
        if (['ko', 'en', 'zh', 'th', 'id'].includes(browserLang)) {
          currentLang = browserLang;
        }
        if (navigator.language.toLowerCase().includes('zh-tw') || 
            navigator.language.toLowerCase().includes('zh-hk')) {
          currentLang = 'zh-tw';
        }
      }
      const select = document.getElementById('langSelect');
      if (select) select.value = currentLang;
      document.documentElement.lang = currentLang;
    }

    // ====== ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ======
    function setupEventListeners() {
      // ê²€ìƒ‰ (ë””ë°”ìš´ìŠ¤)
      const input = document.getElementById('searchInput');
      if (input) {
        input.addEventListener('input', (e) => {
          const val = e.target.value;
          clearTimeout(_searchTimer);
          _searchTimer = setTimeout(() => filterBySearch(val), 120);
        });
      }
      
      // ì¹´í…Œê³ ë¦¬ íƒ­
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          currentCategory = tab.dataset.category;
          filterByCategory(currentCategory);
        });
      });
      
      // ì–¸ì–´ ë³€ê²½
      document.getElementById('langSelect').addEventListener('change', (e) => {
        currentLang = e.target.value;
        localStorage.setItem('selectedLang', currentLang);
        document.documentElement.lang = currentLang;
        updateLanguage();
        renderCoupons();
      });
      
      // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
      document.getElementById('modal').addEventListener('click', (e) => {
        if (e.target.id === 'modal') {
          closeModal();
        }
      });
    }

    // ====== ì–¸ì–´ ì—…ë°ì´íŠ¸ ======
    function updateLanguage() {
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[currentLang][key]) {
          el.textContent = translations[currentLang][key];
        }
      });
      
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        if (translations[currentLang][key]) {
          el.placeholder = translations[currentLang][key];
        }
      });
    }

    // ====== ë‚ ì§œ ê³„ì‚° í•¨ìˆ˜ (ì¼ë³¸ ì‹œê°„ ê¸°ì¤€) ======
    function getDaysLeft(expiryDate) {
      if (!expiryDate || expiryDate === '9999-12-31') return 999;
      
      // ì¼ë³¸ ì‹œê°„ ê¸°ì¤€ ë§Œë£Œì¼ (23:59:59 JST)
      const expiry = new Date(`${expiryDate}T23:59:59+09:00`);
      
      // í˜„ì¬ ì¼ë³¸ ì‹œê°„ (ë¡œì»¬ -> JST ë³´ì •)
      const now = new Date();
      const jstOffset = 9 * 60; // JSTëŠ” UTC+9
      const localOffset = now.getTimezoneOffset(); // ë¶„
      const diff = (jstOffset + localOffset) * 60 * 1000;
      const nowJST = new Date(now.getTime() + diff);
      
      const diffTime = expiry - nowJST;
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      
      return diffDays > 0 ? diffDays : 0;
    }

    // ====== ì¹´í…Œê³ ë¦¬ ë°°ì§€ ì—…ë°ì´íŠ¸ ======
    function updateCategoryBadges() {
      const counts = {
        all: couponsData.length,
        electronics: couponsData.filter(c => c.category === 'electronics').length,
        fashion: couponsData.filter(c => c.category === 'fashion').length,
        dining: couponsData.filter(c => c.category === 'dining').length,
        transport: couponsData.filter(c => c.category === 'transport').length,
        saved: savedCoupons.length
      };
      
      Object.keys(counts).forEach(cat => {
        const el = document.querySelector(`.tab[data-category="${cat}"] .badge`);
        if (el) el.textContent = counts[cat];
      });
    }

    // ====== ì¿ í° ë Œë”ë§ ======
    function renderCoupons() {
      const grid = document.getElementById('couponGrid');
      const noResults = document.getElementById('noResults');
      
      if (filteredCoupons.length === 0) {
        grid.style.display = 'none';
        noResults.classList.add('show');
        return;
      }
      
      grid.style.display = 'grid';
      noResults.classList.remove('show');
      
      grid.innerHTML = filteredCoupons.map(coupon => {
        const isSaved = savedCoupons.includes(coupon.id);
        const store = coupon[`store_${currentLang}`] || coupon.store_ko || coupon.store_en || 'åº—èˆ—å';
        const offer = coupon[`offer_${currentLang}`] || coupon.offer || coupon.offer_en || 'Offer';
        const desc  = coupon[`description_${currentLang}`] || coupon.description_ko || coupon.description_en || '';
        const area  = coupon[`area_${currentLang}`] || coupon.area_ko || coupon.area_en || '';
        const daysLeft = getDaysLeft(coupon.expiry);

        const badgeText = (daysLeft === 0) ? translations[currentLang].expires_today
                                           : `${daysLeft} ${translations[currentLang].days_left}`;
        
        // ë§Œë£Œ ì„ë°• ë°°ì§€
        const expiryBadge = (daysLeft <= 7 && daysLeft !== 999) 
          ? `<div class="expiry-badge">ğŸ”¥ ${esc(badgeText)}</div>` : '';
        
        // onclick/keydown ì ‘ê·¼ì„± + ì•ˆì „í•œ ì¶œë ¥
        return `
          <div class="coupon-card" onclick="showModal(${coupon.id})" tabindex="0" role="button"
               aria-label="${esc(store)} - ${esc(offer)}"
               onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();showModal(${coupon.id});}">
            ${expiryBadge}
            <img src="${esc(coupon.image)}" alt="${esc(store)}" loading="lazy">
            <div class="coupon-body">
              <div class="coupon-title">${esc(store)}</div>
              <div class="coupon-offer">${esc(offer)}</div>
              <div class="coupon-desc">${esc(desc)}</div>
              <div class="coupon-footer">
                <span class="coupon-area">ğŸ“ ${esc(area)}</span>
                <button type="button" class="save-btn ${isSaved ? 'saved' : ''}" 
                        onclick="event.stopPropagation(); toggleSave(${coupon.id})">
                  ${isSaved ? 'â­' : 'â˜†'} ${translations[currentLang][isSaved ? 'unsave' : 'save']}
                </button>
              </div>
            </div>
          </div>
        `;
      }).join('');
      
      updateCategoryBadges();
    }

    // ====== í•„í„°ë§ ======
    function filterBySearch(query) {
      query = String(query || '').toLowerCase();
      
      const matcher = (coupon) => {
        const store = (coupon[`store_${currentLang}`] || coupon.store_ko || coupon.store_en || '').toLowerCase();
        const area  = (coupon[`area_${currentLang}`] || coupon.area_ko || coupon.area_en || '').toLowerCase();
        const desc  = (coupon[`description_${currentLang}`] || coupon.description_ko || coupon.description_en || '').toLowerCase();
        return store.includes(query) || area.includes(query) || desc.includes(query);
      };

      if (currentCategory === 'saved') {
        filteredCoupons = couponsData.filter(c => savedCoupons.includes(c.id) && matcher(c));
      } else if (currentCategory === 'all') {
        filteredCoupons = couponsData.filter(matcher);
      } else {
        filteredCoupons = couponsData.filter(c => c.category === currentCategory && matcher(c));
      }
      
      renderCoupons();
    }

    function filterByCategory(category) {
      const searchValue = document.getElementById('searchInput').value;
      
      if (category === 'all') {
        filteredCoupons = [...couponsData];
      } else if (category === 'saved') {
        filteredCoupons = couponsData.filter(c => savedCoupons.includes(c.id));
      } else {
        filteredCoupons = couponsData.filter(c => c.category === category);
      }
      
      if (searchValue) {
        filterBySearch(searchValue);
      } else {
        renderCoupons();
      }
    }

    // ====== ì €ì¥ ê¸°ëŠ¥ ======
    function toggleSave(id) {
      if (savedCoupons.includes(id)) {
        savedCoupons = savedCoupons.filter(sid => sid !== id);
      } else {
        savedCoupons.push(id);
      }
      localStorage.setItem('savedCoupons', JSON.stringify(savedCoupons));
      renderCoupons();
      updateSavedInfo();
      updateCategoryBadges();
    }

    function updateSavedInfo() {
      const info = document.getElementById('savedInfo');
      const count = document.getElementById('savedCount');
      const badge = document.getElementById('savedBadge');
      
      const savedCount = savedCoupons.length;
      
      if (savedCount > 0) {
        info.classList.add('show');
        count.textContent = savedCount;
        badge.textContent = savedCount;
      } else {
        info.classList.remove('show');
        badge.textContent = '0';
      }
    }

    // ====== ëª¨ë‹¬ ======
    function showModal(id) {
      const coupon = couponsData.find(c => c.id === id);
      if (!coupon) return;

      _lastFocused = document.activeElement;

      const modal = document.getElementById('modal');
      const modalBody = document.getElementById('modalBody');
      
      const store = coupon[`store_${currentLang}`] || coupon.store_ko || coupon.store_en || 'åº—èˆ—å';
      const offer = coupon[`offer_${currentLang}`] || coupon.offer || coupon.offer_en || 'Offer';
      const termsRaw = (coupon[`terms_${currentLang}`] || coupon.terms_ko || coupon.terms_en || '');
      const terms = termsRaw.split('|');
      const area  = coupon[`area_${currentLang}`] || coupon.area_ko || coupon.area_en || '';
      const daysLeft = getDaysLeft(coupon.expiry);
      const badgeText = (daysLeft === 0) ? translations[currentLang].expires_today
                                         : `${daysLeft} ${translations[currentLang].days_left}`;
      const expiry = daysLeft === 999 ? translations[currentLang].no_expiry 
                     : `${coupon.expiry} (${badgeText})`;
      
      // ëª¨ë‹¬ HTML (ì•ˆì „í•œ ë Œë”ë§)
      modalBody.innerHTML = `
        <div class="modal-title" id="modalTitle">${esc(store)}</div>
        <div class="modal-offer">${esc(offer)}</div>
        
        <div class="coupon-code-box">
          <div class="coupon-code">${esc(coupon.code)}</div>
          <button type="button" class="btn btn-primary" id="copyBtn" onclick="copyCode('${String(coupon.code || '')}')">
            ğŸ“‹ ${translations[currentLang].copy}
          </button>
        </div>
        
        ${(coupon.article_url || coupon.official_url || coupon.maps_url) ? `
        <div class="links-section">
          ${coupon.article_url ? `
          <a href="${esc(coupon.article_url)}" target="_blank" rel="noopener noreferrer" class="link-item">
            <span class="link-label">
              <span>ğŸ“°</span>
              <span>${translations[currentLang].view_article}</span>
            </span>
            <span class="link-arrow">â†’</span>
          </a>` : ''}
          ${coupon.official_url ? `
          <a href="${esc(coupon.official_url)}" target="_blank" rel="noopener noreferrer" class="link-item">
            <span class="link-label">
              <span>ğŸŒ</span>
              <span>${translations[currentLang].visit_website}</span>
            </span>
            <span class="link-arrow">â†’</span>
          </a>` : ''}
          ${coupon.maps_url ? `
          <a href="${esc(coupon.maps_url)}" target="_blank" rel="noopener noreferrer" class="link-item">
            <span class="link-label">
              <span>ğŸ“</span>
              <span>${translations[currentLang].view_map}</span>
            </span>
            <span class="link-arrow">â†’</span>
          </a>` : ''}
        </div>` : ''}
        
        <div class="share-section">
          <button type="button" class="btn btn-secondary share-btn" onclick="shareCode('${coupon.id}')">
            ğŸ“¤ ${translations[currentLang].share}
          </button>
        </div>
        
        <div class="modal-section">
          <h3>${translations[currentLang].terms}</h3>
          <ul id="termsList"></ul>
        </div>
        
        <div class="modal-info">ğŸ“ ${esc(area)}</div>
        <div class="modal-info">ğŸ“… ${translations[currentLang].expiry}: ${esc(expiry)}</div>
        
        <button type="button" class="btn btn-secondary close-modal-btn" onclick="closeModal()">
          ${translations[currentLang].close}
        </button>
      `;
      
      // ì•½ê´€ì„ ì•ˆì „í•˜ê²Œ ì¶”ê°€ (XSS ë°©ì§€)
      const termsList = modalBody.querySelector('#termsList');
      if (termsList) {
        terms.forEach(term => {
          if (term.trim()) {
            const li = document.createElement('li');
            li.textContent = term.trim();
            termsList.appendChild(li);
          }
        });
      }

      // ëª¨ë‹¬ í‘œì‹œ + ìŠ¤í¬ë¡¤ ì ê¸ˆ + ARIA
      modal.classList.add('show');
      modal.removeAttribute('aria-hidden');
      document.body.style.overflow = 'hidden';

      // í¬ì»¤ìŠ¤ ì´ë™ ë° ê°„ë‹¨ íŠ¸ë©
      const focusables = modal.querySelectorAll('button, [href], [tabindex]:not([tabindex="-1"])');
      const first = focusables[0];
      const last  = focusables[focusables.length - 1];
      if (first) first.focus();

      _trapHandler = function(e){
        if (e.key !== 'Tab') return;
        if (focusables.length === 0) return;
        if (e.shiftKey && document.activeElement === first) {
          e.preventDefault(); last.focus();
        } else if (!e.shiftKey && document.activeElement === last) {
          e.preventDefault(); first.focus();
        }
      };
      modal.addEventListener('keydown', _trapHandler);
    }

    function closeModal() {
      const modal = document.getElementById('modal');
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
      if (_trapHandler) {
        modal.removeEventListener('keydown', _trapHandler);
        _trapHandler = null;
      }
      if (_lastFocused) _lastFocused.focus();
    }

    function copyCode(code) {
      const btn = document.getElementById('copyBtn');
      const text = String(code || '');
      
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(() => {
          showCopied();
        }).catch(() => {
          fallbackCopy(text);
        });
      } else {
        fallbackCopy(text);
      }
      
      function fallbackCopy(val) {
        const textarea = document.createElement('textarea');
        textarea.value = val;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        showCopied();
      }
      
      function showCopied() {
        if (!btn) return;
        btn.classList.add('copied');
        btn.textContent = 'âœ… ' + translations[currentLang].copied;
        setTimeout(() => {
          btn.classList.remove('copied');
          btn.innerHTML = 'ğŸ“‹ ' + translations[currentLang].copy;
        }, 2000);
      }
    }
    
    // ====== ê³µìœ  ê¸°ëŠ¥ ======
    async function shareCode(couponId) {
      const coupon = couponsData.find(c => c.id === parseInt(couponId));
      if (!coupon) return;
      
      const store = coupon[`store_${currentLang}`] || coupon.store_ko || coupon.store_en || 'åº—èˆ—å';
      const shareUrl = `${window.location.origin}${window.location.pathname}?coupon=${couponId}&lang=${currentLang}`;
      
      const shareData = {
        title: store,
        text: `${store} - ${coupon.code}`,
        url: shareUrl
      };
      
      try {
        if (navigator.share) {
          await navigator.share(shareData);
        } else {
          // Fallback: URL ë³µì‚¬
          await navigator.clipboard.writeText(shareUrl);
          alert(translations[currentLang].copied);
        }
      } catch (err) {
        console.log('Share failed:', err);
      }
    }

    // ====== ë”¥ë§í¬ ì ìš© ======
    function applyDeepLink() {
      const p = new URLSearchParams(location.search);
      const lang = p.get('lang');
      const couponId = parseInt(p.get('coupon'), 10);
      if (lang && ['ko','en','zh','zh-tw','th','id'].includes(lang)) {
        currentLang = lang;
        localStorage.setItem('selectedLang', lang);
        document.documentElement.lang = lang;
        const select = document.getElementById('langSelect');
        if (select) select.value = lang;
        updateLanguage();
      }
      if (couponId) showModal(couponId);
    }
  </script>

  <!-- WordPress í†µí•© ì•ˆë‚´ -->
  <script>
    // ====== WordPress ì—…ì²´ìš© í†µí•© ê°€ì´ë“œ ======
    // 
    // 1. Custom Post Type ìƒì„±
    //    - Post Type: 'coupon'
    //    - ì§€ì›: title, editor, thumbnail
    //
    // 2. ACF (Advanced Custom Fields) í•„ë“œ ì„¤ì •
    //    í•„ìˆ˜ í•„ë“œ:
    //    - store_name (í…ìŠ¤íŠ¸)
    //    - offer (í…ìŠ¤íŠ¸)
    //    - category (ì„ íƒ: electronics/fashion/dining/transport)
    //    - expiry_date (ë‚ ì§œ ì„ íƒê¸°)
    //    - coupon_code (í…ìŠ¤íŠ¸)
    //    - area (í…ìŠ¤íŠ¸)
    //    - terms (í…ìŠ¤íŠ¸ ì˜ì—­, | êµ¬ë¶„ì ì‚¬ìš©)
    //    
    //    ë§í¬ í•„ë“œ (ì„ íƒ):
    //    - article_url (URL)
    //    - official_url (URL)
    //    - maps_url (URL)
    //
    // 3. Polylang ì„¤ì •
    //    - 6ê°œ ì–¸ì–´ ë“±ë¡: ko, en, zh, zh-tw, th, id
    //    - ê° í•„ë“œë³„ ë²ˆì—­ ë¬¸ìì—´ ë“±ë¡
    //
    // 4. PHP í…œí”Œë¦¿ (page-coupons.php)
    /*
    <?php
    $coupons = get_posts(['post_type' => 'coupon', 'numberposts' => -1]);
    $coupons_json = [];
    
    foreach($coupons as $coupon) {
        $fields = get_fields($coupon->ID);
        $coupons_json[] = [
            'id' => $coupon->ID,
            'store_ko' => $fields['store_name'],
            'store_en' => pll_translate_string($fields['store_name'], 'en'),
            'store_zh' => pll_translate_string($fields['store_name'], 'zh'),
            'store_zh_tw' => pll_translate_string($fields['store_name'], 'zh-tw'),
            'store_th' => pll_translate_string($fields['store_name'], 'th'),
            'store_id' => pll_translate_string($fields['store_name'], 'id'),
            'offer' => $fields['offer'],
            'category' => $fields['category'],
            'expiry' => $fields['expiry_date'],
            'code' => $fields['coupon_code'],
            'area_ko' => $fields['area'],
            'terms_ko' => $fields['terms'],
            'article_url' => $fields['article_url'] ?? '',
            'official_url' => $fields['official_url'] ?? '',
            'maps_url' => $fields['maps_url'] ?? '',
            'image' => get_the_post_thumbnail_url($coupon->ID, 'large')
        ];
    }
    ?>
    
  </script>
</body>
</html>
