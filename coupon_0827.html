<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JAPANKURU Wallet</title>
  <style>
    :root{
      --primary:#007AFF;--secondary:#5856D6;--success:#34C759;--warning:#FF9500;--danger:#FF3B30;
      --gray-50:#F2F2F7;--gray-100:#E5E5EA;--gray-200:#D1D1D6;--gray-300:#C7C7CC;--gray-400:#AEAEB2;--gray-500:#8E8E93;
      --gray-600:#636366;--gray-700:#48484A;--gray-800:#2C2C2E;--gray-900:#1C1C1E;
      --bg:#FFFFFF;--surface:#F2F2F7;--text:#000000;--text-secondary:#8E8E93;
      --radius:20px;--radius-sm:12px;--radius-xs:8px;
      --shadow-sm:0 1px 3px rgba(0,0,0,0.12);--shadow:0 4px 12px rgba(0,0,0,0.08);--shadow-lg:0 10px 40px rgba(0,0,0,0.12);
      --font:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text","Helvetica Neue",sans-serif;
    }
    @media(prefers-color-scheme:dark){
      :root{--bg:#000;--surface:#1C1C1E;--text:#fff;--text-secondary:#8E8E93;--gray-50:#1C1C1E;--gray-100:#2C2C2E;}
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:var(--font);background:var(--surface);color:var(--text);line-height:1.5;font-size:17px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}
    header{background:rgba(255,255,255,0.8);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:.5px solid var(--gray-200);position:sticky;top:0;z-index:100}
    @media(prefers-color-scheme:dark){header{background:rgba(28,28,30,0.8)}}
    .header-inner{display:flex;justify-content:space-between;align-items:center;height:52px}
    .logo{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--text);font-weight:600;font-size:19px}
    .logo img{height:28px;width:auto}
    .lang-select{padding:6px 12px;border:none;border-radius:var(--radius-xs);background:var(--gray-100);color:var(--text);font-size:15px;cursor:pointer;font-family:inherit;min-width:120px;transition:all .2s}
    .lang-select:hover{background:var(--gray-200)}
    .lang-select:focus{outline:none;box-shadow:0 0 0 4px rgba(0,122,255,0.3)}
    .hero{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;padding:60px 40px;border-radius:var(--radius);margin:30px 0;text-align:center}
    .hero h1{font-size:48px;font-weight:700;margin-bottom:12px;letter-spacing:-.02em}
    .hero p{font-size:21px;opacity:.95}
    @media(max-width:768px){.hero{padding:40px 20px}.hero h1{font-size:32px}.hero p{font-size:17px}}
    .search-bar{margin-bottom:30px}
    .search-wrapper{position:relative}
    .search-input{width:100%;padding:16px 20px 16px 48px;border:none;border-radius:var(--radius-sm);background:var(--bg);font-size:17px;transition:all .2s;box-shadow:var(--shadow)}
    .search-icon{position:absolute;left:20px;top:50%;transform:translateY(-50%);color:var(--gray-400);pointer-events:none}
    .search-input:focus{outline:none;box-shadow:0 0 0 4px rgba(0,122,255,0.3)}
    .search-input::placeholder{color:var(--gray-400)}
    .tabs{display:flex;gap:10px;margin-bottom:30px;overflow-x:auto;padding-bottom:10px;-webkit-overflow-scrolling:touch;scrollbar-width:none}
    .tabs::-webkit-scrollbar{display:none}
    .tab{padding:10px 20px;border:none;background:var(--bg);border-radius:100px;cursor:pointer;font-size:15px;font-weight:500;white-space:nowrap;transition:all .2s;box-shadow:var(--shadow-sm);color:var(--text);font-family:inherit}
    .tab:hover{transform:scale(1.05);box-shadow:var(--shadow)}
    .tab.active{background:var(--primary);color:#fff;box-shadow:0 4px 12px rgba(0,122,255,0.3)}
    .tab .badge{display:inline-block;background:rgba(0,0,0,0.1);padding:2px 8px;border-radius:100px;font-size:12px;margin-left:6px;font-weight:600}
    .tab.active .badge{background:rgba(255,255,255,0.3)}
    .coupon-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:24px;margin-bottom:60px}
    @media(max-width:768px){.coupon-grid{grid-template-columns:1fr;gap:16px}}
    .coupon-card{background:var(--bg);border-radius:var(--radius-sm);overflow:hidden;box-shadow:var(--shadow);transition:all .3s cubic-bezier(.25,.46,.45,.94);cursor:pointer;position:relative}
    .coupon-card:hover{transform:translateY(-8px);box-shadow:var(--shadow-lg)}
    .coupon-card:focus{outline:2px solid var(--primary);outline-offset:2px}
    .coupon-card img{width:100%;height:200px;object-fit:cover}
    .expiry-badge{position:absolute;top:12px;right:12px;background:var(--danger);color:#fff;padding:6px 12px;border-radius:100px;font-size:13px;font-weight:600;box-shadow:var(--shadow)}
    .coupon-body{padding:20px}
    .coupon-title{font-size:22px;font-weight:600;margin-bottom:8px;letter-spacing:-.01em}
    .coupon-offer{font-size:28px;color:var(--danger);font-weight:700;margin-bottom:12px}
    .coupon-desc{font-size:15px;color:var(--text-secondary);margin-bottom:16px;line-height:1.4;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}
    .coupon-footer{display:flex;justify-content:space-between;align-items:center;padding-top:16px;border-top:1px solid var(--gray-100)}
    .coupon-area{font-size:14px;color:var(--text-secondary);display:flex;align-items:center;gap:6px}
    .save-btn{padding:8px 16px;border:none;background:var(--gray-100);border-radius:100px;cursor:pointer;font-size:14px;font-weight:500;transition:all .2s;display:flex;align-items:center;gap:4px;font-family:inherit}
    .save-btn:hover{background:var(--gray-200);transform:scale(1.05)}
    .save-btn.saved{background:var(--warning);color:#fff}
    .save-btn.saved:hover{background:#FF8800}
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);z-index:1000;padding:20px;overflow-y:auto}
    .modal.show{display:flex;align-items:center;justify-content:center;animation:fadeIn .3s}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .modal-content{background:var(--bg);border-radius:var(--radius);width:100%;max-width:500px;max-height:90vh;overflow-y:auto;position:relative;animation:slideUp .3s;box-shadow:var(--shadow-lg)}
    @keyframes slideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
    .modal-body{padding:30px}
    .modal-close{position:absolute;top:20px;right:20px;width:36px;height:36px;border:none;background:var(--gray-100);border-radius:50%;cursor:pointer;font-size:20px;display:flex;align-items:center;justify-content:center;transition:all .2s;color:var(--text)}
    .modal-close:hover{background:var(--gray-200);transform:scale(1.1)}
    .modal-title{font-size:28px;font-weight:600;margin-bottom:8px;padding-right:40px;letter-spacing:-.02em}
    .modal-offer{font-size:36px;color:var(--danger);font-weight:700;margin-bottom:16px}
    .links-section{display:flex;flex-direction:column;gap:12px;margin:16px 0 24px;padding:20px;background:var(--surface);border-radius:var(--radius-sm)}
    .link-item{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--bg);border-radius:var(--radius-xs);text-decoration:none;color:var(--text);transition:all .2s;border:1px solid var(--gray-100)}
    .link-item:hover{background:var(--gray-50);transform:translateX(4px);box-shadow:var(--shadow-sm)}
    .link-label{display:flex;align-items:center;gap:12px;font-size:15px;font-weight:500}
    .link-arrow{color:var(--gray-400);font-size:14px}
    .modal-section{margin-bottom:24px}
    .modal-section h3{font-size:17px;font-weight:600;margin-bottom:12px;color:var(--text-secondary)}
    .modal-section ul{list-style:none;padding:0}
    .modal-section li{font-size:15px;color:var(--text);margin-bottom:8px;padding-left:20px;position:relative;line-height:1.5}
    .modal-section li:before{content:"â€¢";position:absolute;left:8px;color:var(--gray-400)}
    .modal-info{display:flex;align-items:center;gap:8px;font-size:15px;color:var(--text-secondary);margin-bottom:8px}
    .saved-info{background:linear-gradient(135deg,var(--warning),#FF8800);color:#fff;padding:16px 20px;border-radius:var(--radius-sm);margin-bottom:24px;display:none;font-weight:500;box-shadow:var(--shadow)}
    .saved-info.show{display:block}
    .no-results{text-align:center;padding:80px 20px;display:none}
    .no-results.show{display:block}
    .no-results-icon{font-size:72px;margin-bottom:20px;opacity:.5}
    .share-section{display:flex;gap:12px;margin:20px 0}
    .share-btn{flex:1}
    @media(max-width:640px){.modal-content{margin:20px;max-height:calc(100vh - 40px)}.tabs{padding:0 20px 10px;margin:0 -20px 30px}}
    /* back image box */
    .coupon-back-box{background:var(--surface);padding:12px;border-radius:var(--radius-sm);text-align:center;margin-bottom:24px}
    .coupon-back-box img{max-width:100%;height:auto;border-radius:var(--radius-xs);box-shadow:var(--shadow-sm);cursor:zoom-in}
    .coupon-back-box .hint{font-size:12px;color:var(--text-secondary);margin-top:8px}
    /* error banner */
    #loadError{display:none;background:#FF3B30;color:#fff;padding:12px 16px;border-radius:12px;margin:16px 0}
  </style>
</head>
<body>

<header>
  <div class="container">
    <div class="header-inner">
      <a href="/" class="logo">
        <img src="https://japankuru.com/gld-kanri/data/themes/japankuru/assets/images/logo.svg" alt="Japankuru">
        <span>Wallet</span>
      </a>
      <select id="langSelect" class="lang-select" aria-label="Language">
        <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
        <option value="en">ğŸ‡ºğŸ‡¸ English</option>
        <option value="zh">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</option>
        <option value="zh-tw">ğŸ‡¹ğŸ‡¼ ç¹é«”ä¸­æ–‡</option>
        <option value="th">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</option>
        <option value="id">ğŸ‡®ğŸ‡© Indonesia</option>
      </select>
    </div>
  </div>
</header>

<div class="container">
  <!-- error banner -->
  <div id="loadError"></div>

  <div class="hero">
    <h1 data-i18n="hero_title">ì¼ë³¸ ì—¬í–‰ í• ì¸ ì¿ í°</h1>
    <p data-i18n="hero_desc">ì¸ê¸° ë§¤ì¥ì—ì„œ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ í• ì¸ ì¿ í°</p>
  </div>

  <div class="search-bar">
    <div class="search-wrapper">
      <span class="search-icon">ğŸ”</span>
      <input id="searchInput" class="search-input" type="search"
        placeholder="ë§¤ì¥ëª…, ì§€ì—­ìœ¼ë¡œ ê²€ìƒ‰..." data-i18n-placeholder="search_placeholder"/>
    </div>
  </div>

  <div class="tabs" id="categoryTabs">
    <button type="button" class="tab active" data-category="all">
      <span data-i18n="cat_all">ì „ì²´</span> <span class="badge">0</span>
    </button>
    <button type="button" class="tab" data-category="electronics">
      <span>ğŸ”Œ</span> <span data-i18n="cat_electronics">ì „ìì œí’ˆ</span> <span class="badge">0</span>
    </button>
    <button type="button" class="tab" data-category="fashion">
      <span>ğŸ‘•</span> <span data-i18n="cat_fashion">íŒ¨ì…˜</span> <span class="badge">0</span>
    </button>
    <button type="button" class="tab" data-category="dining">
      <span>ğŸ½ï¸</span> <span data-i18n="cat_dining">ë§›ì§‘</span> <span class="badge">0</span>
    </button>
    <button type="button" class="tab" data-category="transport">
      <span>ğŸš‡</span> <span data-i18n="cat_transport">êµí†µ</span> <span class="badge">0</span>
    </button>
    <button type="button" class="tab" data-category="saved">
      <span>â­</span> <span data-i18n="cat_saved">ì €ì¥ë¨</span> <span class="badge" id="savedBadge">0</span>
    </button>
  </div>

  <div class="saved-info" id="savedInfo">
    <span data-i18n="saved_info">ì €ì¥ëœ ì¿ í°</span> <strong id="savedCount">0</strong><span data-i18n="saved_unit">ê°œ</span>
  </div>

  <div class="coupon-grid" id="couponGrid"></div>

  <div class="no-results" id="noResults">
    <div class="no-results-icon">ğŸ”</div>
    <h3 data-i18n="no_results">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
    <p data-i18n="no_results_desc">ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”</p>
  </div>
</div>

<div class="modal" id="modal" aria-hidden="true">
  <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <button type="button" class="modal-close" onclick="closeModal()" aria-label="Close">Ã—</button>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<script>
  // ==== ìƒ˜í”Œ ë°ì´í„°(ë°ëª¨ ì „ìš©) ====
  const couponsData = [
    {
      id:1,
      store_ko:'ì½”ì§€ë§ˆ x ë¹…ì¹´ë©”ë¼', store_en:'Kojima x BicCamera', store_zh:'å°å²› x Bic Camera',
      store_zh_tw:'å°å³¶ x Bic Camera', store_th:'à¹‚à¸„à¸ˆà¸´à¸¡à¸° x à¸šà¸´à¸à¸„à¸²à¹€à¸¡à¸£à¹ˆà¸²', store_id:'Kojima x BicCamera',
      offer:'ìµœëŒ€ 17% OFF', offer_en:'Up to 17% OFF',
      description_ko:'ë©´ì„¸ 10% + ì¶”ê°€ 7% í• ì¸!', description_en:'Tax-free 10% + Additional 7% discount!',
      category:'electronics', expiry:'2025-12-31',
      image:'https://japankuru.com/gld-kanri/data/uploads/2023/11/kojima%E8%8B%B1%E8%AA%9E%E7%89%88%E4%BC%81%E6%A5%AD%E6%9C%89_kojima_EN_B-2.jpg',
      image_back:'https://dummyimage.com/900x600/222/fff&text=KOJIMA+COUPON+BACK',
      area_ko:'ì•„í‚¤í•˜ë°”ë¼', area_en:'Akihabara',
      terms_ko:'íƒ€ í• ì¸ê³¼ ì¤‘ë³µ ë¶ˆê°€|ì¼ë¶€ í’ˆëª© ì œì™¸|ê³„ì‚° ì „ ì œì‹œ|1ì¸ 1íšŒ',
      terms_en:'Cannot combine|Some items excluded|Show before payment|Once per person',
      article_url:'https://www.japankuru.com/en/e2290.html', official_url:'https://www.biccamera.com',
      maps_url:'https://maps.google.com/?q=35.6909,139.7003'
    },
    {
      id:2,
      store_ko:'ì§„ìŠ¤ (JINS)', store_en:'JINS', store_zh:'JINS', store_zh_tw:'JINS', store_th:'à¸ˆà¸´à¸™à¸ªà¹Œ', store_id:'JINS',
      offer:'10% OFF', offer_en:'10% OFF',
      description_ko:'ë©´ì„¸+í• ì¸ ì•ˆê²½', description_en:'Tax-free + discount glasses',
      category:'fashion', expiry:'2025-02-05',
      image:'https://japankuru.com/gld-kanri/data/uploads/2024/06/japankuru_1800-1200-1536x1024.jpg',
      image_back:'https://dummyimage.com/900x600/333/fff&text=JINS+COUPON+BACK',
      area_ko:'ì‹œë¶€ì•¼', area_en:'Shibuya',
      terms_ko:'íƒ€ í• ì¸ê³¼ ì¤‘ë³µ ë¶ˆê°€|ì¼ë¶€ í’ˆëª© ì œì™¸', terms_en:'Cannot combine|Some items excluded',
      article_url:'https://www.japankuru.com/en/e2291.html', official_url:'https://www.jins.com',
      maps_url:'https://maps.google.com/?q=35.6581,139.6986'
    }
  ];

  // ==== ìƒíƒœ ====
  let currentLang='ko';
  let savedCoupons=JSON.parse(localStorage.getItem('savedCoupons')||'[]');
  let filteredCoupons=[...couponsData];
  let currentCategory='all';
  let _lastFocused=null,_trapHandler=null,_searchTimer=null;

  // ==== ë²ˆì—­ ====
  const translations={
    ko:{hero_title:'ì¼ë³¸ ì—¬í–‰ í• ì¸ ì¿ í°',hero_desc:'ì¸ê¸° ë§¤ì¥ì—ì„œ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ í• ì¸ ì¿ í°',search_placeholder:'ë§¤ì¥ëª…, ì§€ì—­ìœ¼ë¡œ ê²€ìƒ‰...',
        cat_all:'ì „ì²´',cat_electronics:'ì „ìì œí’ˆ',cat_fashion:'íŒ¨ì…˜',cat_dining:'ë§›ì§‘',cat_transport:'êµí†µ',cat_saved:'ì €ì¥ë¨',
        saved_info:'ì €ì¥ëœ ì¿ í°',saved_unit:'ê°œ',no_results:'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤',no_results_desc:'ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”',
        close:'ë‹«ê¸°',terms:'ì´ìš©ì¡°ê±´',expiry:'ìœ íš¨ê¸°í•œ',no_expiry:'ë¬´ì œí•œ',share:'ê³µìœ ',view_article:'ê´€ë ¨ ê¸°ì‚¬',visit_website:'ê³µì‹ í™ˆí˜ì´ì§€',view_map:'ì§€ë„ ë³´ê¸°',
        days_left:'ì¼ ë‚¨ìŒ',expires_today:'ì˜¤ëŠ˜ ë§ˆê°',open_full:'ì´ë¯¸ì§€ë¥¼ íƒ­í•˜ë©´ í¬ê²Œ ì—´ë¦½ë‹ˆë‹¤',load_error:'ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”ã€‚',
        no_data:'í‘œì‹œí•  ì¿ í°ì´ ì—†ìŠµë‹ˆë‹¤',no_data_desc:'ê´€ë¦¬ìì—ì„œ ë°ì´í„°ë¥¼ ì¶”ê°€í•´ ì£¼ì„¸ìš”'},
    en:{hero_title:'Japan Travel Discount Coupons',hero_desc:'Instant discounts at popular stores',search_placeholder:'Search by store or area...',
        cat_all:'All',cat_electronics:'Electronics',cat_fashion:'Fashion',cat_dining:'Dining',cat_transport:'Transport',cat_saved:'Saved',
        saved_info:'Saved coupons',saved_unit:'',no_results:'No results found',no_results_desc:'Try different search terms',
        close:'Close',terms:'Terms',expiry:'Expiry',no_expiry:'No expiry',share:'Share',view_article:'Related Article',visit_website:'Official Website',view_map:'View Map',
        days_left:'days left',expires_today:'Ends today',open_full:'Tap image to open full size',load_error:'Failed to load data. Please try again later.',
        no_data:'No coupons to display',no_data_desc:'Please add data in admin'},
    zh:{hero_title:'æ—¥æœ¬æ—…è¡Œä¼˜æƒ åˆ¸',hero_desc:'çƒ­é—¨å•†åº—å³æ—¶æŠ˜æ‰£',search_placeholder:'æŒ‰åº—åæˆ–åœ°åŒºæœç´¢...',
        cat_all:'å…¨éƒ¨',cat_electronics:'ç”µå­äº§å“',cat_fashion:'æ—¶å°š',cat_dining:'ç¾é£Ÿ',cat_transport:'äº¤é€š',cat_saved:'å·²ä¿å­˜',
        saved_info:'å·²ä¿å­˜çš„ä¼˜æƒ åˆ¸',saved_unit:'å¼ ',no_results:'æ²¡æœ‰æ‰¾åˆ°ç»“æœ',no_results_desc:'å°è¯•å…¶ä»–æœç´¢è¯',
        close:'å…³é—­',terms:'ä½¿ç”¨æ¡æ¬¾',expiry:'æœ‰æ•ˆæœŸ',no_expiry:'æ— æœŸé™',share:'åˆ†äº«',view_article:'ç›¸å…³æ–‡ç« ',visit_website:'å®˜æ–¹ç½‘ç«™',view_map:'æŸ¥çœ‹åœ°å›¾',
        days_left:'å¤©å‰©ä½™',expires_today:'ä»Šå¤©åˆ°æœŸ',open_full:'ç‚¹å‡»å›¾ç‰‡å¯æ”¾å¤§æŸ¥çœ‹',load_error:'æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚',
        no_data:'æš‚æ— ä¼˜æƒ åˆ¸',no_data_desc:'è¯·åœ¨åå°æ·»åŠ æ•°æ®'},
    'zh-tw':{hero_title:'æ—¥æœ¬æ—…è¡Œå„ªæƒ åˆ¸',hero_desc:'ç†±é–€å•†åº—å³æ™‚æŠ˜æ‰£',search_placeholder:'æŒ‰åº—åæˆ–åœ°å€æœç´¢...',
        cat_all:'å…¨éƒ¨',cat_electronics:'é›»å­ç”¢å“',cat_fashion:'æ™‚å°š',cat_dining:'ç¾é£Ÿ',cat_transport:'äº¤é€š',cat_saved:'å·²ä¿å­˜',
        saved_info:'å·²ä¿å­˜çš„å„ªæƒ åˆ¸',saved_unit:'å¼µ',no_results:'æ²’æœ‰æ‰¾åˆ°çµæœ',no_results_desc:'å˜—è©¦å…¶ä»–æœç´¢è©',
        close:'é—œé–‰',terms:'ä½¿ç”¨æ¢æ¬¾',expiry:'æœ‰æ•ˆæœŸ',no_expiry:'ç„¡æœŸé™',share:'åˆ†äº«',view_article:'ç›¸é—œæ–‡ç« ',visit_website:'å®˜æ–¹ç¶²ç«™',view_map:'æŸ¥çœ‹åœ°åœ–',
        days_left:'å¤©å‰©é¤˜',expires_today:'ä»Šå¤©åˆ°æœŸ',open_full:'é»æ“Šåœ–ç‰‡å¯æ”¾å¤§æŸ¥çœ‹',load_error:'è³‡æ–™è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚',
        no_data:'ç›®å‰æ²’æœ‰å„ªæƒ åˆ¸',no_data_desc:'è«‹æ–¼å¾Œå°æ–°å¢è³‡æ–™'},
    th:{hero_title:'à¸„à¸¹à¸›à¸­à¸‡à¸ªà¹ˆà¸§à¸™à¸¥à¸”à¸à¸²à¸£à¸—à¹ˆà¸­à¸‡à¹€à¸—à¸µà¹ˆà¸¢à¸§à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™',hero_desc:'à¸ªà¹ˆà¸§à¸™à¸¥à¸”à¸—à¸±à¸™à¸—à¸µà¸—à¸µà¹ˆà¸£à¹‰à¸²à¸™à¸„à¹‰à¸²à¸¢à¸­à¸”à¸™à¸´à¸¢à¸¡',search_placeholder:'à¸„à¹‰à¸™à¸«à¸²à¸•à¸²à¸¡à¸Šà¸·à¹ˆà¸­à¸£à¹‰à¸²à¸™à¸«à¸£à¸·à¸­à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆ...',
        cat_all:'à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”',cat_electronics:'à¸­à¸´à¹€à¸¥à¹‡à¸à¸—à¸£à¸­à¸™à¸´à¸à¸ªà¹Œ',cat_fashion:'à¹à¸Ÿà¸Šà¸±à¹ˆà¸™',cat_dining:'à¸­à¸²à¸«à¸²à¸£',cat_transport:'à¸à¸²à¸£à¹€à¸”à¸´à¸™à¸—à¸²à¸‡',cat_saved:'à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸¥à¹‰à¸§',
        saved_info:'à¸„à¸¹à¸›à¸­à¸‡à¸—à¸µà¹ˆà¸šà¸±à¸™à¸—à¸¶à¸',saved_unit:'à¹ƒà¸š',no_results:'à¹„à¸¡à¹ˆà¸à¸šà¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ',no_results_desc:'à¸¥à¸­à¸‡à¸„à¸³à¸„à¹‰à¸™à¸«à¸²à¸­à¸·à¹ˆà¸™',
        close:'à¸›à¸´à¸”',terms:'à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚',expiry:'à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸',no_expiry:'à¹„à¸¡à¹ˆà¸¡à¸µà¸à¸³à¸«à¸™à¸”',share:'à¹à¸Šà¸£à¹Œ',view_article:'à¸šà¸—à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡',visit_website:'à¹€à¸§à¹‡à¸šà¹„à¸‹à¸•à¹Œà¸­à¸¢à¹ˆà¸²à¸‡à¹€à¸›à¹‡à¸™à¸—à¸²à¸‡à¸à¸²à¸£',view_map:'à¸”à¸¹à¹à¸œà¸™à¸—à¸µà¹ˆ',
        days_left:'à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸«à¸¥à¸·à¸­',expires_today:'à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸à¸§à¸±à¸™à¸™à¸µà¹‰',open_full:'à¹à¸•à¸°à¸£à¸¹à¸›à¹€à¸à¸·à¹ˆà¸­à¹€à¸›à¸´à¸”à¸‚à¸™à¸²à¸”à¹ƒà¸«à¸à¹ˆ',load_error:'à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§ à¹‚à¸›à¸£à¸”à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆà¸ à¸²à¸¢à¸«à¸¥à¸±à¸‡',
        no_data:'à¹„à¸¡à¹ˆà¸¡à¸µà¸„à¸¹à¸›à¸­à¸‡',no_data_desc:'à¹‚à¸›à¸£à¸”à¹€à¸à¸´à¹ˆà¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸™à¸«à¸¥à¸±à¸‡à¸šà¹‰à¸²à¸™'},
    id:{hero_title:'Kupon Diskon Perjalanan Jepang',hero_desc:'Diskon instan di toko-toko populer',search_placeholder:'Cari berdasarkan nama toko atau area...',
        cat_all:'Semua',cat_electronics:'Elektronik',cat_fashion:'Fashion',cat_dining:'Kuliner',cat_transport:'Transportasi',cat_saved:'Tersimpan',
        saved_info:'Kupon tersimpan',saved_unit:'',no_results:'Tidak ada hasil',no_results_desc:'Coba kata kunci lain',
        close:'Tutup',terms:'Syarat',expiry:'Berlaku hingga',no_expiry:'Tidak terbatas',share:'Bagikan',view_article:'Artikel Terkait',visit_website:'Situs Resmi',view_map:'Lihat Peta',
        days_left:'hari tersisa',expires_today:'Berakhir hari ini',open_full:'Ketuk gambar untuk membuka ukuran penuh',load_error:'Gagal memuat data. Coba lagi nanti.',
        no_data:'Tidak ada kupon',no_data_desc:'Silakan tambahkan data di admin'}
  };

  // ==== ìœ í‹¸ ====
  function esc(s){return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}

  // ==== ì´ˆê¸°í™” ====
  document.addEventListener('DOMContentLoaded',()=>{
    detectLanguage(); updateLanguage();
    if(!Array.isArray(couponsData)){document.getElementById('loadError').textContent=translations[currentLang].load_error;document.getElementById('loadError').style.display='block'}
    filteredCoupons=[...couponsData]; renderCoupons(); updateSavedInfo(); updateCategoryBadges();
    setupEventListeners();
    const modalContent=document.querySelector('.modal-content'); if(modalContent){modalContent.setAttribute('role','dialog');modalContent.setAttribute('aria-modal','true')}
    document.addEventListener('keydown',e=>{if(e.key==='Escape')closeModal()});
    applyDeepLink();
  });

  function detectLanguage(){
    const saved=localStorage.getItem('selectedLang');
    if(saved && ['ko','en','zh','zh-tw','th','id'].includes(saved)){currentLang=saved}
    else{
      const bl=navigator.language.slice(0,2);
      if(['ko','en','zh','th','id'].includes(bl)) currentLang=bl;
      if(navigator.language.toLowerCase().includes('zh-tw')||navigator.language.toLowerCase().includes('zh-hk')) currentLang='zh-tw';
    }
    const sel=document.getElementById('langSelect'); if(sel) sel.value=currentLang;
    document.documentElement.lang=currentLang;
  }

  function setupEventListeners(){
    const input=document.getElementById('searchInput');
    if(input){input.addEventListener('input',e=>{const v=e.target.value;clearTimeout(_searchTimer);_searchTimer=setTimeout(()=>filterBySearch(v),120)})}
    document.querySelectorAll('.tab').forEach(tab=>{
      tab.addEventListener('click',()=>{document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));tab.classList.add('active');currentCategory=tab.dataset.category;filterByCategory(currentCategory)});
    });
    document.getElementById('langSelect').addEventListener('change',e=>{
      currentLang=e.target.value; localStorage.setItem('selectedLang',currentLang);
      document.documentElement.lang=currentLang; updateLanguage(); renderCoupons();
    });
    document.getElementById('modal').addEventListener('click',e=>{if(e.target.id==='modal') closeModal()});
  }

  function updateLanguage(){
    document.querySelectorAll('[data-i18n]').forEach(el=>{const k=el.getAttribute('data-i18n'); if(translations[currentLang][k]) el.textContent=translations[currentLang][k]});
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el=>{const k=el.getAttribute('data-i18n-placeholder'); if(translations[currentLang][k]) el.placeholder=translations[currentLang][k]});
  }

  function getDaysLeft(expiryDate){
    if(!expiryDate || expiryDate==='9999-12-31') return 999;
    const expiry=new Date(`${expiryDate}T23:59:59+09:00`);
    const now=new Date(); const jstOffset=9*60; const localOffset=now.getTimezoneOffset(); const diff=(jstOffset+localOffset)*60*1000;
    const nowJST=new Date(now.getTime()+diff);
    const diffTime=expiry-nowJST; const diffDays=Math.ceil(diffTime/(1000*60*60*24));
    return diffDays>0?diffDays:0;
  }

  function updateCategoryBadges(){
    const counts={all:couponsData.length,electronics:couponsData.filter(c=>c.category==='electronics').length,
      fashion:couponsData.filter(c=>c.category==='fashion').length,dining:couponsData.filter(c=>c.category==='dining').length,
      transport:couponsData.filter(c=>c.category==='transport').length,saved:savedCoupons.length};
    Object.keys(counts).forEach(cat=>{const el=document.querySelector(`.tab[data-category="${cat}"] .badge`); if(el) el.textContent=counts[cat]});
  }

  function renderCoupons(){
    const grid=document.getElementById('couponGrid'); const noRes=document.getElementById('noResults');
    if(!Array.isArray(filteredCoupons) || filteredCoupons.length===0){grid.style.display='none'; noRes.classList.add('show'); return}
    grid.style.display='grid'; noRes.classList.remove('show');
    grid.innerHTML=filteredCoupons.map(c=>{
      const isSaved=savedCoupons.includes(c.id);
      const store=c[`store_${currentLang}`]||c.store_ko||c.store_en||'åº—èˆ—å';
      const offer=c[`offer_${currentLang}`]||c.offer||c.offer_en||'Offer';
      const desc =c[`description_${currentLang}`]||c.description_ko||c.description_en||'';
      const area =c[`area_${currentLang}`]||c.area_ko||c.area_en||'';
      const daysLeft=getDaysLeft(c.expiry);
      const badgeText=(daysLeft===0)?translations[currentLang].expires_today:`${daysLeft} ${translations[currentLang].days_left}`;
      const expiryBadge=(daysLeft<=7 && daysLeft!==999)?`<div class="expiry-badge">ğŸ”¥ ${esc(badgeText)}</div>`:'';
      return `
      <div class="coupon-card" onclick="showModal(${c.id})" tabindex="0" role="button"
           aria-label="${esc(store)} - ${esc(offer)}"
           onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();showModal(${c.id});}">
        ${expiryBadge}
        <img src="${esc(c.image)}" alt="${esc(store)}" loading="lazy">
        <div class="coupon-body">
          <div class="coupon-title">${esc(store)}</div>
          <div class="coupon-offer">${esc(offer)}</div>
          <div class="coupon-desc">${esc(desc)}</div>
          <div class="coupon-footer">
            <span class="coupon-area">ğŸ“ ${esc(area)}</span>
            <button type="button" class="save-btn ${isSaved?'saved':''}" onclick="event.stopPropagation();toggleSave(${c.id})">
              ${isSaved?'â­':'â˜†'} ${translations[currentLang][isSaved?'unsave':'save']|| (isSaved?'Unsave':'Save')}
            </button>
          </div>
        </div>
      </div>`;
    }).join('');
    updateCategoryBadges();
  }

  function filterBySearch(q){
    q=String(q||'').toLowerCase();
    const match=c=>{
      const store=(c[`store_${currentLang}`]||c.store_ko||c.store_en||'').toLowerCase();
      const area =(c[`area_${currentLang}`]||c.area_ko||c.area_en||'').toLowerCase();
      const desc =(c[`description_${currentLang}`]||c.description_ko||c.description_en||'').toLowerCase();
      return store.includes(q)||area.includes(q)||desc.includes(q);
    };
    if(currentCategory==='saved'){filteredCoupons=couponsData.filter(c=>savedCoupons.includes(c.id)&&match(c));}
    else if(currentCategory==='all'){filteredCoupons=couponsData.filter(match);}
    else{filteredCoupons=couponsData.filter(c=>c.category===currentCategory && match(c))}
    renderCoupons();
  }
  function filterByCategory(cat){
    const q=document.getElementById('searchInput').value;
    if(cat==='all') filteredCoupons=[...couponsData];
    else if(cat==='saved') filteredCoupons=couponsData.filter(c=>savedCoupons.includes(c.id));
    else filteredCoupons=couponsData.filter(c=>c.category===cat);
    if(q) filterBySearch(q); else renderCoupons();
  }
  function toggleSave(id){
    if(savedCoupons.includes(id)) savedCoupons=savedCoupons.filter(x=>x!==id); else savedCoupons.push(id);
    localStorage.setItem('savedCoupons',JSON.stringify(savedCoupons));
    renderCoupons(); updateSavedInfo(); updateCategoryBadges();
  }
  function updateSavedInfo(){
    const info=document.getElementById('savedInfo'); const cnt=document.getElementById('savedCount'); const badge=document.getElementById('savedBadge');
    const n=savedCoupons.length; if(n>0){info.classList.add('show'); cnt.textContent=n; badge.textContent=n}else{info.classList.remove('show'); badge.textContent='0'}
  }

  function showModal(id){
    const c=couponsData.find(x=>x.id===id); if(!c) return;
    _lastFocused=document.activeElement;
    const modal=document.getElementById('modal'); const body=document.getElementById('modalBody');
    const store=c[`store_${currentLang}`]||c.store_ko||c.store_en||'åº—èˆ—å';
    const offer=c[`offer_${currentLang}`]||c.offer||c.offer_en||'Offer';
    const terms=(c[`terms_${currentLang}`]||c.terms_ko||c.terms_en||'').split('|').map(s=>s.trim()).filter(Boolean);
    const area =c[`area_${currentLang}`]||c.area_ko||c.area_en||'';
    const daysLeft=getDaysLeft(c.expiry);
    const badgeText=(daysLeft===0)?translations[currentLang].expires_today:`${daysLeft} ${translations[currentLang].days_left}`;
    const expiry=(daysLeft===999)?translations[currentLang].no_expiry:`${c.expiry} (${badgeText})`;

    body.innerHTML = `
      <div class="modal-title" id="modalTitle">${esc(store)}</div>
      <div class="modal-offer">${esc(offer)}</div>

      ${c.image_back ? `
      <div class="coupon-back-box">
        <img src="${esc(c.image_back)}" alt="${esc(store)} - back" loading="lazy"
             onclick="window.open('${esc(c.image_back)}','_blank')">
        <div class="hint">${esc(translations[currentLang].open_full)}</div>
      </div>`:''}

      ${(c.article_url||c.official_url||c.maps_url)?`
      <div class="links-section">
        ${c.article_url?`
        <a href="${esc(c.article_url)}" target="_blank" rel="noopener noreferrer" class="link-item">
          <span class="link-label"><span>ğŸ“°</span><span>${translations[currentLang].view_article}</span></span><span class="link-arrow">â†’</span>
        </a>`:''}
        ${c.official_url?`
        <a href="${esc(c.official_url)}" target="_blank" rel="noopener noreferrer" class="link-item">
          <span class="link-label"><span>ğŸŒ</span><span>${translations[currentLang].visit_website}</span></span><span class="link-arrow">â†’</span>
        </a>`:''}
        ${c.maps_url?`
        <a href="${esc(c.maps_url)}" target="_blank" rel="noopener noreferrer" class="link-item">
          <span class="link-label"><span>ğŸ“</span><span>${translations[currentLang].view_map}</span></span><span class="link-arrow">â†’</span>
        </a>`:''}
      </div>`:''}

      <div class="share-section">
        <button type="button" class="btn btn-secondary share-btn" onclick="shareCode('${c.id}')">ğŸ“¤ ${translations[currentLang].share}</button>
      </div>

      <div class="modal-section">
        <h3>${translations[currentLang].terms}</h3>
        <ul id="termsList"></ul>
      </div>

      <div class="modal-info">ğŸ“ ${esc(area)}</div>
      <div class="modal-info">ğŸ“… ${translations[currentLang].expiry}: ${esc(expiry)}</div>

      <button type="button" class="btn btn-secondary close-modal-btn" onclick="closeModal()">${translations[currentLang].close}</button>
    `;
    const ul=body.querySelector('#termsList'); terms.forEach(t=>{const li=document.createElement('li'); li.textContent=t; ul.appendChild(li)});
    modal.classList.add('show'); modal.removeAttribute('aria-hidden'); document.body.style.overflow='hidden';
    const focusables=modal.querySelectorAll('button,[href],[tabindex]:not([tabindex="-1"])'); const first=focusables[0], last=focusables[focusables.length-1]; if(first) first.focus();
    _trapHandler=function(e){if(e.key!=='Tab')return; if(focusables.length===0)return; if(e.shiftKey && document.activeElement===first){e.preventDefault(); last.focus()} else if(!e.shiftKey && document.activeElement===last){e.preventDefault(); first.focus()}};
    modal.addEventListener('keydown',_trapHandler);
  }
  function closeModal(){
    const modal=document.getElementById('modal'); modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); document.body.style.overflow='';
    if(_trapHandler){modal.removeEventListener('keydown',_trapHandler); _trapHandler=null} if(_lastFocused) _lastFocused.focus();
  }
  async function shareCode(couponId){
    const c=couponsData.find(x=>x.id===parseInt(couponId)); if(!c) return;
    const store=c[`store_${currentLang}`]||c.store_ko||c.store_en||'åº—èˆ—å';
    const shareUrl=`${location.origin}${location.pathname}?coupon=${couponId}&lang=${currentLang}`;
    const data={title:store,text:store,url:shareUrl};
    try{if(navigator.share){await navigator.share(data)}else{await navigator.clipboard.writeText(shareUrl); alert('URL Copied')}}catch(e){console.log('Share failed',e)}
  }
  function applyDeepLink(){
    const p=new URLSearchParams(location.search); const lang=p.get('lang'); const id=parseInt(p.get('coupon'),10);
    if(lang && ['ko','en','zh','zh-tw','th','id'].includes(lang)){currentLang=lang; localStorage.setItem('selectedLang',lang); document.documentElement.lang=lang; const sel=document.getElementById('langSelect'); if(sel) sel.value=lang; updateLanguage()}
    if(id) showModal(id);
  }
</script>
</body>
</html>
